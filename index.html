<!DOCTYPE html>
<html lang="en" class="dark"> <!-- Default to dark theme -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CineTorrentto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Roboto+Slab:wght@400;700&family=Roboto:wght@400;500;700&family=Audiowide&display=swap" rel="stylesheet">
    <link href="https://fonts.maateen.me/durbin/font.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Define color variables for light and dark themes */
        :root {
            --brand-red: #c54533;
            --brand-orange: #e8a265;
        }

        /* Apply theme variables */
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
        body {
            font-family: 'Roboto', sans-serif;
            font-size: 14px; /* Smaller base font size */
        }
        
        .bengali {
            font-family: 'Durbineto', sans-serif;
        }

        .font-condensed { font-family: 'Roboto Condensed', sans-serif; }
        .font-slab { font-family: 'Roboto Slab', sans-serif; }


        /* Dark Theme */
        .dark {
            background-color: #1a1a1a;
            color: #f9fafb;
        }
        .dark .main-header { background-color: rgba(26, 26, 26, 0.8); }
        .dark .movie-card { background-color: #262626; }
        .dark .modal-content { background-color: #262626; }
        .dark .form-input { background-color: #404040; border-color: #525252; color: #f9fafb; }
        .dark .category-btn, .dark .genre-btn, .dark .year-btn, .dark .alphabet-btn, .dark .rating-btn { color: #a3a3a3; }
        .dark .category-btn:hover, .dark .genre-btn:hover, .dark .year-btn:hover, .dark .alphabet-btn:hover, .dark .rating-btn:hover { background-color: #404040; }
        .dark h2 { color: var(--brand-orange); }
        .dark .download-section { background-color: #262626; }
        .dark .comment { background-color: #404040; }
        .dark #log-out { border-color: #404040; color: #f9fafb;}
        .dark #log-out:hover { background-color: #404040; }
        .dark .dropdown-menu { background-color: #262626; }
        .dark .dropdown-menu a:hover { background-color: #404040; }
        .dark .sidebar { border-color: #262626; background-color: #1a1a1a; }
        .dark details summary { background-color: #262626; }
        .dark details[open] summary { background-color: #404040; }
        .dark .ad-placeholder { background-color: #262626; border-color: #404040; }
        .dark footer { background-color: #111; }
        .dark .site-title { background-color: rgba(255, 255, 255, 0.1); }


        /* Light Theme */
        .light {
            background-color: #f5f5f5;
            color: #1a1a1a;
        }
        .light .main-header { background-color: rgba(255, 255, 255, 0.8); }
        .light .movie-card { background-color: #ffffff; }
        .light .modal-content { background-color: #ffffff; }
        .light .form-input { background-color: #e5e5e5; border-color: #d4d4d4; color: #1a1a1a; }
        .light .category-btn, .light .genre-btn, .light .year-btn, .light .alphabet-btn, .light .rating-btn { color: #525252; }
        .light .category-btn:hover, .light .genre-btn:hover, .light .year-btn:hover, .light .alphabet-btn:hover, .light .rating-btn:hover { background-color: #e5e5e5; }
        .light h2 { color: var(--brand-red); }
        .light .movie-card h3 { color: #1a1a1a; }
        .light .movie-card p { color: #525252; }
        .light .modal-content h2, .light .modal-content h3, .light .modal-content p { color: #1a1a1a; }
        .light .modal-content .text-gray-400 { color: #525252 !important; }
        .light .download-section { background-color: #e5e5e5; }
        .light .download-section p { color: #1a1a1a; }
        .light .comment { background-color: #f0f0f0; }
        .light #log-out { color: #1a1a1a; border-color: #d4d4d4; }
        .light #log-out:hover { background-color: #e5e5e5; }
        .light .dropdown-menu { background-color: #ffffff; }
        .light .dropdown-menu a:hover { background-color: #f0f0f0; }
        .light .sidebar { border-color: #e5e5e5; background-color: #f5f5f5; }
        .light details summary { background-color: #f0f0f0; }
        .light details[open] summary { background-color: #e5e5e5; }
        .light .ad-placeholder { background-color: #e5e5e5; border-color: #d4d4d4; }
        .light footer { background-color: #e5e5e5; }
        .light .site-title { background-color: rgba(0, 0, 0, 0.05); }


        .hero-bg {
            background-image: linear-gradient(to right, rgba(26, 26, 26, 0.9) 30%, rgba(26, 26, 26, 0.5)), url('https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        #main-app {
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        .dark #main-app {
             background-image: linear-gradient(rgba(26, 26, 26, 0.97), rgba(26, 26, 26, 0.97)), url('https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=2070&auto=format&fit=crop');
        }
         .light #main-app {
             background-image: linear-gradient(rgba(245, 245, 245, 0.97), rgba(245, 245, 245, 0.97)), url('https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=2070&auto=format&fit=crop');
        }
        
        .active-btn, .year-btn.active-btn, .genre-btn.active-btn, .alphabet-btn.active-btn, .rating-btn.active-btn, .nav-link.active-btn {
            background-color: var(--brand-red);
            color: white !important;
            border-color: var(--brand-red);
        }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(4px);
        }
        
        /* Custom scrollbar for a modern feel */
        ::-webkit-scrollbar { width: 8px; }
        .dark ::-webkit-scrollbar-track { background: #262626; }
        .light ::-webkit-scrollbar-track { background: #e5e5e5; }
        .dark ::-webkit-scrollbar-thumb { background: #525252; border-radius: 10px; }
        .light ::-webkit-scrollbar-thumb { background: #a3a3a3; border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb:hover { background: #737373; }
        .light ::-webkit-scrollbar-thumb:hover { background: #8a8a8a; }
        
        /* Sidebar dropdown styles */
        details > summary {
            list-style: none;
            cursor: pointer;
        }
        details > summary::-webkit-details-marker {
            display: none;
        }
        details > summary::after {
            content: ' ▸';
            float: right;
            transition: transform 0.2s;
        }
        details[open] > summary::after {
            transform: rotate(90deg);
        }
        
        .site-title {
            cursor: pointer;
            font-family: 'Audiowide', cursive;
            font-weight: bold;
            letter-spacing: 1.5px;
            padding: 4px 12px;
            border-radius: 8px;
        }

        .ad-placeholder {
            border: 2px dashed;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 12px;
            overflow: hidden;
            margin: 0 auto;
        }
        .ad-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Featured Slider */
        #featured-slider {
            scroll-behavior: smooth;
            scrollbar-width: none; /* Firefox */
        }
        #featured-slider::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        
        .featured-movie-card {
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            background-size: cover;
            background-position: center;
        }
        .featured-movie-card::before {
            content: '';
            display: block;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
        }
        .featured-movie-card .content {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8) 20%, rgba(0,0,0,0) 60%);
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 1rem;
        }
        
        #main-content-area {
            flex-grow: 1;
        }

    </style>
</head>
<body class="flex flex-col min-h-screen">
    <div id="ad-popunder"></div>
    <!-- Login Section -->
    <main id="login-section" class="flex-grow flex flex-col relative">
         <!-- Social Icons -->
        <div class="absolute top-4 right-4 flex items-center gap-4 z-10">
            <div id="social-icons-container" class="flex items-center gap-3">
                 <!-- Icons will be injected by JS -->
            </div>
        </div>

        <section class="flex-grow flex items-center justify-center hero-bg w-full">
            <div class="w-11/12 max-w-4xl mx-auto flex flex-col md:flex-row justify-between items-center gap-10 py-20">

                <div class="md:w-1/2 text-center md:text-left">
                     <h1 id="login-title" class="site-title text-5xl" style="color: #e8a265;">CineTorrentto</h1>
                    <p class="w-full text-base my-6 text-gray-300">Your ultimate gateway to the world of cinema. Discover, track, and explore thousands of movies, from timeless classics to the latest blockbusters.</p>
                    
                    <!-- Counters -->
                    <div class="my-6 flex flex-col md:flex-row items-center justify-center md:justify-start gap-x-6 gap-y-3 text-orange-300">
                        <div class="flex items-center gap-3">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                              <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a3.002 3.002 0 014.288 0M12 14a4 4 0 100-8 4 4 0 000 8z" />
                            </svg>
                            <p>
                                <span id="visitor-count" class="font-bold text-base">0</span> Visitors This Month
                            </p>
                        </div>
                        <div id="total-users-login-container" class="flex items-center gap-3">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M15 21a6 6 0 00-9-5.197M15 21a6 6 0 006-6v-1a6 6 0 00-6-6h-1m-4 16a6 6 0 01-2-11.657" /></svg>
                             <p>
                                <span id="total-users-count-login" class="font-bold text-base">0</span> Total Users
                            </p>
                        </div>
                    </div>

                    <!-- Login/Signup Container -->
                    <div class="w-full max-w-sm mx-auto md:mx-0 bg-neutral-900/50 backdrop-blur-sm p-8 rounded-lg">
                        
                        <!-- Login Form -->
                        <div id="login-form-container">
                            <h2 class="text-xl font-bold text-center mb-6 text-orange-300">Login</h2>
                            <fieldset class="fieldset w-full pb-4">
                                <input id="name" type="text" class="input bg-neutral-800 border-neutral-700 w-full mb-3 p-3 rounded-md focus:ring-red-500 focus:border-red-500" placeholder="Username" />
                                <input id="pass" type="password" class="input bg-neutral-800 border-neutral-700 w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" placeholder="Password" />
                                <p id="login-error" class="text-red-400 text-sm mt-2 hidden">Invalid username or password.</p>
                            </fieldset>
                            <button id="login-btn" class="w-full bg-red-600 text-white rounded-md px-4 py-3 font-semibold hover:bg-red-700 transition-colors duration-300">Login</button>
                             <div class="text-right mt-2">
                                <a href="#" id="forgot-password-link" class="text-sm text-red-400 hover:underline">Forgot Password?</a>
                            </div>
                            <p class="text-center mt-4 text-sm text-gray-400">
                                Don't have an account? <a href="#" id="show-signup" class="text-red-400 hover:underline">Sign Up</a>
                            </p>
                        </div>

                        <!-- Signup Form -->
                        <div id="signup-form" class="hidden">
                            <h2 class="text-xl font-bold text-center mb-6 text-orange-300">Create Account</h2>
                            <fieldset class="fieldset w-full pb-4 space-y-3">
                                <input id="new-fullname" type="text" class="input bg-neutral-800 border-neutral-700 w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" placeholder="Full Name" />
                                <input id="new-name" type="text" class="input bg-neutral-800 border-neutral-700 w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" placeholder="Choose Username" />
                                <input id="new-pass" type="password" class="input bg-neutral-800 border-neutral-700 w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" placeholder="Create Password" />
                                <input id="confirm-pass" type="password" class="input bg-neutral-800 border-neutral-700 w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" placeholder="Confirm Password" />
                            </fieldset>
                            <button id="signup-btn" class="w-full bg-red-600 text-white rounded-md px-4 py-3 font-semibold hover:bg-red-700 transition-colors duration-300">Create Account</button>
                            <div class="mt-2 text-left">
                                <p id="signup-username-error" class="text-red-400 text-xs mt-1 hidden"></p>
                                <p id="signup-password-error" class="text-red-400 text-xs mt-1 hidden"></p>
                                <p id="signup-error" class="text-red-400 text-sm mt-2 hidden"></p>
                            </div>
                            <p class="text-center mt-4 text-sm text-gray-400">
                                Already have an account? <a href="#" id="show-login" class="text-red-400 hover:underline">Login</a>
                            </p>
                        </div>
                    </div>
                </div>

                <div class="md:w-1/2 flex justify-center opacity-50">
                     <svg xmlns="http://www.w3.org/2000/svg" width="250" height="250" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="text-orange-300/50">
                        <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect><line x1="7" y1="2" x2="7" y2="22"></line><line x1="17" y1="2" x2="17" y2="22"></line><line x1="2" y1="12" x2="22" y2="12"></line><line x1="2" y1="7" x2="7" y2="7"></line><line x1="2" y1="17" x2="7" y2="17"></line><line x1="17" y1="17" x2="22" y2="17"></line><line x1="17" y1="7" x2="22" y2="7"></line>
                    </svg>
                </div>
            </div>
        </section>
        
        <!-- Download Info Section -->
        <section class="py-12 download-section text-center">
            <div class="container mx-auto px-4">
                <p class="text-base">Please let us know in the comments if you have any problems downloading. We will resolve the issue quickly.</p>
                <p class="text-base text-gray-400 mb-6 bengali">(ডাউনলোড করতে সমস্যা হলে অবশ্যই কমেন্টে করে জানাবেন। আমরা সমস্যার দ্রুত সমাধান করব।)</p>
                
                <p class="text-base">To download, you must have one of the following 4 apps installed. If not, please install it using the links below.</p>
                <p class="text-base text-gray-400 mb-10 bengali">(ডাউনলোড করার জন্য নিচের ৪টি অ্যাপ এর মধ্যে যেকোনো একটি ইন্সটল থাকতে হবে। না থাকলে অনুগ্রহ করে নিচের লিঙ্কগুলো থেকে ইন্সটল করে নিন।)</p>

                <div class="grid md:grid-cols-2 gap-12">
                    <div>
                        <h3 class="text-xl font-bold mb-4">Android User</h3>
                        <div class="flex justify-center gap-4 flex-wrap">
                            <a href="https://play.google.com/store/apps/details?id=org.freedownloadmanager.fdm&hl=en&referrer=utm_source%3Dgoogle%26utm_medium%3Dorganic%26utm_term%3Dfdm&pcampaignid=APPU_1_XB7LZ_HnK63H4-EP8PnbgQw" target="_blank" class="bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-neutral-700 transition-colors">FDM</a>
                            <a href="https://play.google.com/store/apps/details?id=com.dv.adm&hl=en&referrer=utm_source%3Dgoogle%26utm_medium%3Dorganic%26utm_term%3Dadm&pcampaignid=APPU_1_IJLMZ9iVB-nG4-EPlr-RuQM" target="_blank" class="bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-neutral-700 transition-colors">ADM</a>
                            <a href="https://play.google.com/store/apps/details?id=com.utorrent.client&hl=en&referrer=utm_source%3Dgoogle%26utm_medium%3Dorganic%26utm_term%3Dutorrent&pcampaignid=APPU_1_B5LMZ-W0IM6XjuMP1I3T0Q4" target="_blank" class="bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-neutral-700 transition-colors">µTorrent</a>
                            <a href="https://play.google.com/store/apps/details?id=com.bittorrent.client&hl=en&referrer=utm_source%3Dgoogle%26utm_medium%3Dorganic%26utm_term%3Dbittorrent&pcampaignid=APPU_1_2pHMZ7LTG9Oq4-EP3qnzsQQ" target="_blank" class="bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-neutral-700 transition-colors">BitTorrent</a>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold mb-4">PC User</h3>
                        <div class="flex justify-center gap-4 flex-wrap">
                            <a href="https://files2.freedownloadmanager.org/6/latest/fdm_x64_setup.exe" target="_blank" class="bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-neutral-700 transition-colors">FDM</a>
                            <a href="https://www.utorrent.com/web/downloads/complete/track/stable/os/win/" target="_blank" class="bg-black text-white px-8 py-3 rounded-full font-semibold hover:bg-neutral-700 transition-colors">µTorrent</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Main App Section (Initially Hidden) -->
    <div id="main-app" class="hidden w-full h-full">
        <!-- Header -->
        <header class="main-header backdrop-blur-sm sticky top-0 z-40 shadow-lg shadow-black/20">
            <div class="w-full mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex items-center justify-between h-20">
                    <div class="flex items-center gap-2">
                        <button id="filter-toggle-btn" class="p-2 rounded-md focus:outline-none">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2a1 1 0 01-.293.707L16 11.414V16a1 1 0 01-.293.707l-2 2A1 1 0 0113 18v-6.586l-3.707-3.707A1 1 0 019 7V4a1 1 0 01-1-1H4a1 1 0 01-1-1z" />
                            </svg>
                        </button>
                        <span id="header-title" class="site-title text-3xl" style="color: #e8a265;">CineTorrentto</span>
                        <nav id="main-nav" class="hidden lg:flex items-center gap-2">
                            <!-- Navigation links will be populated by JS -->
                        </nav>
                    </div>
                    
                    <div class="hidden md:flex flex-1 justify-center px-4">
                        <div class="w-full max-w-md">
                            <div class="relative">
                                <input id="search-bar" type="text" placeholder="Search movies or years..." class="form-input w-full rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-red-500 transition-all">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <svg class="h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-4">
                        <div id="active-user-container" class="hidden lg:flex items-center gap-2">
                           <div class="flex items-center gap-1 text-sm text-gray-400">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
                                <span id="current-users-count">0</span>
                                <span>Active</span>
                            </div>
                            <span id="active-user" class="text-sm font-semibold"></span>
                        </div>
                        <div class="hidden lg:flex items-center gap-2">
                             <button id="theme-toggle-btn" class="p-2 rounded-full text-gray-400 hover:bg-neutral-700">
                                <svg id="theme-icon-light" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                                <svg id="theme-icon-dark" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                             </button>
                             <button id="admin-panel-btn" class="relative px-4 py-2 text-white bg-indigo-600 rounded-full hover:bg-indigo-700 transition-colors font-semibold hidden">
                                Admin Panel
                                <span id="admin-panel-notification-badge" class="absolute -top-1 -right-1 h-5 w-5 rounded-full bg-red-500 text-xs flex items-center justify-center hidden"></span>
                             </button>
                             <button id="request-movie-btn" class="px-4 py-2 text-white bg-sky-600 rounded-full hover:bg-sky-700 transition-colors font-semibold hidden">Request a Movie</button>
                             <button id="log-out" class="px-4 py-2 border rounded-full transition-colors">Logout</button>
                        </div>
                        <div class="lg:hidden">
                            <button id="mobile-menu-btn" class="p-2 rounded-md focus:outline-none">
                                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Featured Section -->
        <section id="featured-section" class="relative w-full mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div id="featured-slider" class="flex overflow-x-auto snap-x snap-mandatory scroll-smooth -mx-2">
                <!-- Featured movies will be injected here -->
            </div>
            <button id="featured-prev" class="absolute top-1/2 left-0 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
            </button>
            <button id="featured-next" class="absolute top-1/2 right-0 transform -translate-y-1/2 bg-black bg-opacity-50 text-white p-2 rounded-full z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
            </button>
        </section>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="hidden fixed inset-0 bg-gray-900 bg-opacity-95 z-50 p-6 overflow-y-auto">
            <div class="flex justify-between items-center mb-8">
                <span class="site-title text-3xl" style="color: #e8a265;">CineTorrentto</span>
                <button id="mobile-menu-close-btn" class="p-2 text-3xl">&times;</button>
            </div>
            <div id="mobile-nav-content" class="flex flex-col gap-2"></div>
        </div>
        
        <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden"></div>
        
        <div class="w-full flex flex-grow">
             <!-- Left Sidebar for Filters -->
            <aside id="left-sidebar" class="sidebar w-64 flex-shrink-0 p-4 space-y-4 hidden">
                <button id="clear-filters-btn" class="w-full px-4 py-2 text-white bg-red-600 rounded-full hover:bg-red-700 transition-colors font-semibold">Clear Filters</button>
                <details>
                    <summary class="text-sm font-bold p-2 rounded-md">Browse by Genre</summary>
                    <div id="genre-container" class="flex flex-col gap-1 mt-2 pl-2">
                        <!-- Genre buttons will be injected here -->
                    </div>
                </details>
                <details>
                    <summary class="text-sm font-bold p-2 rounded-md">Browse by Year</summary>
                    <div id="year-container" class="flex flex-col gap-1 mt-2 pl-2">
                        <!-- Year buttons will be injected here -->
                    </div>
                </details>
                <details>
                    <summary class="text-sm font-bold p-2 rounded-md">Browse Alphabetically</summary>
                    <div id="alphabet-container" class="grid grid-cols-4 gap-2 mt-2 pl-2">
                        <!-- Alphabet buttons will be injected here -->
                    </div>
                </details>
                <details open>
                    <summary class="text-sm font-bold p-2 rounded-md">Browse by Rating</summary>
                    <div id="rating-container" class="flex flex-col gap-1 mt-2 pl-2">
                        <!-- Rating buttons will be injected here -->
                    </div>
                </details>
                <div id="ad-left-1" class="ad-placeholder mt-4" style="width: 160px; height: 300px;">Adsterra 160x300</div>
                <div id="ad-left-img-1" class="ad-placeholder mt-4" style="width: 180px; height: 320px;">Image Ad 180x320</div>
                <div id="ad-left-img-2" class="ad-placeholder mt-4" style="width: 180px; height: 320px;">Image Ad 180x320</div>
                <div id="ad-left-img-3" class="ad-placeholder mt-4" style="width: 180px; height: 320px;">Image Ad 180x320</div>
                <div id="ad-left-img-4" class="ad-placeholder mt-4" style="width: 180px; height: 320px;">Image Ad 180x320</div>
            </aside>

            <!-- Main Content -->
            <div class="flex-grow min-w-0">
                <main id="main-content-area" class="p-4 sm:p-6 lg:p-8">
                     <div id="category-view" class="space-y-8">
                        <!-- Category sections will be injected here -->
                    </div>
                    <div id="filtered-view" class="hidden">
                        <div id="movies-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-7 gap-6">
                            <!-- Movie cards will be injected here -->
                        </div>
                        <div id="no-results" class="hidden flex-col items-center justify-center col-span-full h-60">
                            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mb-4"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line><line x1="13" y1="8" x2="9" y2="12"></line><line x1="9" y1="8" x2="13" y2="12"></line></svg>
                            <h2 class="text-xl font-semibold">No content found.</h2>
                            <p>Try a different search term or category.</p>
                        </div>
                    </div>
                </main>
                <footer class="p-6 text-center">
                    <div id="ad-footer-728x90" class="ad-placeholder mx-auto mb-4" style="width: 728px; height: 90px; max-width: 100%;">Adsterra 728x90</div>
                    <h2 class="site-title text-4xl mb-4" style="color: var(--brand-orange);">CineTorrentto</h2>
                    <p class="text-xs text-gray-500">Copyright &copy; 2024 CineTorrentto. All Rights Reserved.</p>
                    <p class="text-xs text-gray-500 mt-2">Disclaimer: This site does not store any files on its server. All contents are provided by non-affiliated third parties.</p>
                </footer>
            </div>


            <!-- Right Sidebar for Ads & Socials -->
            <aside id="right-sidebar" class="w-48 flex-shrink-0 p-4 space-y-4 hidden xl:block">
                 <div id="right-sidebar-player" class="mb-4"></div>
                 <div id="ad-right-1" class="ad-placeholder mx-auto mb-4" style="width: 320px; height: 250px; max-width: 100%;">Adsterra 320x250</div>
                 <div id="ad-right-2" class="ad-placeholder mx-auto mb-4" style="width: 160px; height: 600px; max-width: 100%;">Adsterra 160x600</div>
                 <div id="ad-right-native" class="ad-placeholder mx-auto mb-4" style="width: 100%; height: auto; min-height: 100px;">Adsterra Native</div>
                 <div id="ad-right-img-1" class="ad-placeholder mx-auto mb-4" style="width: 180px; height: 320px; max-width: 100%;">Image Ad 180x320</div>
                 <div id="ad-right-img-2" class="ad-placeholder mx-auto mb-4" style="width: 180px; height: 320px; max-width: 100%;">Image Ad 180x320</div>
                 <div id="ad-right-img-3" class="ad-placeholder mx-auto mb-4" style="width: 180px; height: 320px; max-width: 100%;">Image Ad 180x320</div>
                 <div id="ad-right-468x60" class="ad-placeholder mx-auto mb-4" style="width: 468px; height: 60px; max-width: 100%;">Adsterra 468x60</div>
                 <div id="ad-right-320x50" class="ad-placeholder mx-auto mb-4" style="width: 320px; height: 50px; max-width: 100%;">Adsterra 320x50</div>
            </aside>
        </div>

        <button id="back-to-top" class="hidden fixed bottom-5 right-5 bg-red-600 text-white p-3 rounded-full shadow-lg z-50">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" /></svg>
        </button>
        
        <div id="floating-social-bar" class="fixed top-1/2 right-0 transform -translate-y-1/2 z-50 flex flex-col gap-2 p-2 bg-black bg-opacity-50 rounded-l-lg">
             <!-- Floating social icons will be injected here -->
        </div>
    </div>

    <!-- Movie Details Modal -->
    <div id="movie-details-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div id="modal-content-wrapper" class="modal-content rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto transform scale-95 transition-transform duration-300">
            <!-- Modal content will be injected here -->
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="admin-panel-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <div class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Admin Panel</h2>
                    <button type="button" id="admin-panel-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <button id="modal-add-movie-btn" class="w-full p-4 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold">Add Content</button>
                    <button id="modal-edit-featured-btn" class="w-full p-4 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold">Edit Featured</button>
                    <button id="modal-edit-socials-btn" class="w-full p-4 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">Edit Socials</button>
                    <button id="modal-edit-ads-btn" class="w-full p-4 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold">Edit Ads</button>
                    <button id="modal-view-requests-btn" class="w-full p-4 bg-amber-600 text-white rounded-lg hover:bg-amber-700 transition-colors font-semibold relative">
                        View Requests
                        <span id="modal-request-notification-badge" class="absolute -top-1 -right-1 h-5 w-5 rounded-full bg-red-500 text-xs flex items-center justify-center hidden"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>


    <!-- Add Movie Form Modal -->
    <div id="add-movie-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-2xl transform scale-95 transition-transform duration-300">
            <form id="add-movie-form" class="p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Add New Content</h2>
                    <button type="button" id="add-movie-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <input name="title" type="text" placeholder="Title" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                    <div class="grid grid-cols-3 gap-4">
                        <select name="release_day" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500"></select>
                        <select name="release_month" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500"></select>
                        <select name="release_year" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500"></select>
                    </div>
                    <input name="poster_path" type="text" placeholder="Poster Image URL" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                    <input name="trailer_url" type="text" placeholder="Trailer URL (YouTube Embed Link)" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                    <input name="stream_url" type="text" placeholder="Stream URL" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                    <input name="vote_average" type="number" step="0.1" min="0" max="10" placeholder="Rating (0.0 - 10.0)" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                    <textarea name="overview" placeholder="Overview / Description" rows="3" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required></textarea>
                    
                    <input name="director" type="text" placeholder="Director(s)" class="form-input w-full p-3 rounded-md">
                    <input name="runningTime" type="text" placeholder="Running Time (e.g., 120 min)" class="form-input w-full p-3 rounded-md">
                    <input name="budget" type="text" placeholder="Budget (e.g., $100 million)" class="form-input w-full p-3 rounded-md">
                    <textarea name="cast" placeholder="Cast (comma separated)" rows="2" class="form-input w-full p-3 rounded-md"></textarea>

                    <div>
                        <label for="genre-select" class="block mb-2 text-sm font-medium text-left">Genre(s) (Hold Ctrl/Cmd to select multiple)</label>
                        <select name="genres" id="genre-select" multiple class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500 h-32">
                            <!-- Genre options will be populated by JS -->
                        </select>
                    </div>
                     <div>
                        <label for="category-select" class="block mb-2 text-sm font-medium text-left">Category</label>
                        <select name="category" id="category-select" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                            <!-- Category options will be populated by JS -->
                        </select>
                    </div>
                </div>
                
                <div class="border-t border-neutral-700 my-6"></div>

                <div>
                    <h3 class="text-lg font-semibold mb-3">Download Links</h3>
                    <div id="download-links-container" class="space-y-4">
                        <!-- Dynamic download link fields will be injected here -->
                    </div>
                    <button type="button" id="add-download-link-btn" class="mt-4 text-red-400 hover:text-red-300 font-semibold text-sm">+ Add Another Link</button>
                </div>

                <div class="mt-8 text-right">
                    <button type="submit" class="bg-red-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">Add Content</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Request Movie Form Modal -->
    <div id="request-movie-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-lg transform scale-95 transition-transform duration-300">
            <form id="request-movie-form" class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Request a Movie</h2>
                    <button type="button" id="request-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="space-y-4">
                    <input name="movieName" type="text" placeholder="Movie Name" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                    <input name="movieYear" type="number" placeholder="Year" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                    <textarea name="movieDescription" placeholder="Description (optional)" rows="4" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500"></textarea>
                </div>
                <div class="mt-8 text-right">
                    <button type="submit" class="bg-sky-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-sky-700 transition-colors">Submit Request</button>
                </div>
            </form>
        </div>
    </div>

    <!-- View Requests Modal (Admin only) -->
    <div id="view-requests-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
         <div class="modal-content rounded-lg shadow-2xl w-full max-w-2xl transform scale-95 transition-transform duration-300">
             <div class="p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">User Movie Requests</h2>
                    <button type="button" id="view-requests-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="requests-list" class="space-y-4">
                    <!-- Requests will be populated here -->
                </div>
                <div class="mt-8 text-right">
                    <button id="clear-requests-btn" class="bg-red-700 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-800 transition-colors">Clear All Requests</button>
                </div>
             </div>
        </div>
    </div>

    <!-- Trailer Modal -->
    <div id="trailer-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-3xl transform scale-95 transition-transform duration-300">
            <div class="p-2 relative" style="padding-top: 56.25%;"> <!-- 16:9 Aspect Ratio -->
                <div id="trailer-content" class="absolute top-0 left-0 w-full h-full">
                    <!-- YouTube iframe will be injected here -->
                </div>
                 <button onclick="closeModal('trailer-modal')" class="absolute -top-2 -right-2 text-gray-400 hover:text-white transition-colors bg-black bg-opacity-50 rounded-full p-1">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Stream Modal -->
    <div id="stream-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-4xl transform scale-95 transition-transform duration-300">
            <div class="p-2 relative" style="padding-top: 56.25%;"> <!-- 16:9 Aspect Ratio -->
                <div id="stream-content" class="absolute top-0 left-0 w-full h-full">
                    <!-- Stream iframe will be injected here -->
                </div>
                 <button onclick="closeModal('stream-modal')" class="absolute -top-2 -right-2 text-gray-400 hover:text-white transition-colors bg-black bg-opacity-50 rounded-full p-1">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Socials Modal (Admin only) -->
    <div id="edit-socials-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-lg transform scale-95 transition-transform duration-300">
            <form id="edit-socials-form" class="p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Edit Social Links</h2>
                    <button type="button" id="edit-socials-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="social-links-inputs-container" class="space-y-4">
                    <!-- Social link inputs will be populated by JS -->
                </div>
                <button type="button" id="add-social-link-btn" class="mt-4 text-red-400 hover:text-red-300 font-semibold text-sm">+ Add New Social Link</button>
                <div class="mt-8 text-right">
                    <button type="submit" class="bg-red-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Ads Modal (Admin only) -->
    <div id="edit-ads-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-4xl transform scale-95 transition-transform duration-300">
            <form id="edit-ads-form" class="p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Edit Ad Codes</h2>
                    <button type="button" id="edit-ads-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Left Sidebar Ads -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold border-b border-neutral-600 pb-2">Left Sidebar</h3>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-left">Adsterra Ad (160x300)</label>
                            <textarea name="adLeft1" rows="3" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" placeholder="Paste Adsterra code here..."></textarea>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-left">Image Ad URLs (180x320)</label>
                            <input name="adLeftImg1" type="text" placeholder="Image URL 1" class="form-input w-full p-3 rounded-md mb-2">
                            <input name="adLeftImg2" type="text" placeholder="Image URL 2" class="form-input w-full p-3 rounded-md mb-2">
                            <input name="adLeftImg3" type="text" placeholder="Image URL 3" class="form-input w-full p-3 rounded-md mb-2">
                            <input name="adLeftImg4" type="text" placeholder="Image URL 4" class="form-input w-full p-3 rounded-md">
                        </div>
                    </div>
                    <!-- Right Sidebar Ads -->
                    <div class="space-y-4">
                        <h3 class="text-lg font-semibold border-b border-neutral-600 pb-2">Right Sidebar</h3>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-left">Video Player URL (YouTube/GDrive)</label>
                            <input name="sidebarVideo" type="text" class="form-input w-full p-3 rounded-md">
                        </div>
                         <div>
                            <label class="block mb-2 text-sm font-medium text-left">Adsterra Ad (320x250)</label>
                            <textarea name="right1" rows="3" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra code here..."></textarea>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-left">Adsterra Ad (160x600)</label>
                            <textarea name="right2" rows="3" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra code here..."></textarea>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-left">Adsterra Native Banner</label>
                            <textarea name="rightNative" rows="3" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra code here..."></textarea>
                        </div>
                         <div>
                            <label class="block mb-2 text-sm font-medium text-left">Image Ad URLs (180x320)</label>
                            <input name="rightImg1" type="text" placeholder="Image URL 1" class="form-input w-full p-3 rounded-md mb-2">
                            <input name="rightImg2" type="text" placeholder="Image URL 2" class="form-input w-full p-3 rounded-md mb-2">
                            <input name="rightImg3" type="text" placeholder="Image URL 3" class="form-input w-full p-3 rounded-md">
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-left">Adsterra Ad (468x60)</label>
                            <textarea name="right468x60" rows="2" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra code here..."></textarea>
                        </div>
                        <div>
                            <label class="block mb-2 text-sm font-medium text-left">Adsterra Ad (320x50)</label>
                            <textarea name="right320x50" rows="2" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra code here..."></textarea>
                        </div>
                    </div>
                </div>
                 <div class="col-span-1 md:col-span-2 mt-6">
                     <h3 class="text-lg font-semibold border-b border-neutral-600 pb-2">Other Ads</h3>
                     <div>
                        <label class="block mb-2 text-sm font-medium text-left">Adsterra Social Bar</label>
                        <textarea name="adSocialBar" rows="3" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra Social Bar code here..."></textarea>
                    </div>
                     <div>
                        <label class="block mb-2 text-sm font-medium text-left mt-4">Adsterra Popunder</label>
                        <textarea name="adPopunder" rows="3" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra Popunder code here..."></textarea>
                    </div>
                     <div>
                        <label class="block mb-2 text-sm font-medium text-left mt-4">Footer Ad (728x90)</label>
                        <textarea name="adFooter728x90" rows="3" class="form-input w-full p-3 rounded-md" placeholder="Paste Adsterra code here..."></textarea>
                    </div>
                </div>
                <div class="mt-8 text-right">
                    <button type="submit" class="bg-red-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">Save Ad Codes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Password Reset Modal -->
    <div id="password-reset-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-md transform scale-95 transition-transform duration-300">
            <form id="password-reset-form" class="p-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Reset Password</h2>
                    <button type="button" id="password-reset-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                <div id="reset-step-1" class="space-y-4">
                    <p class="text-sm text-gray-400">Enter your Full Name and Username to verify your account.</p>
                    <input name="resetFullName" type="text" placeholder="Your Full Name" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                    <input name="resetUsername" type="text" placeholder="Your Username" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                    <p id="reset-error" class="text-red-400 text-sm mt-2 hidden"></p>
                    <button type="button" id="verify-user-btn" class="w-full bg-red-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">Verify</button>
                </div>
                <div id="reset-step-2" class="hidden space-y-4">
                    <p class="text-sm text-gray-400">Verification successful. Enter your new password.</p>
                    <input name="newPassword" type="password" placeholder="New Password" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                    <input name="confirmNewPassword" type="password" placeholder="Confirm New Password" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" required>
                    <p id="reset-password-error" class="text-red-400 text-sm mt-2 hidden"></p>
                    <button type="submit" class="w-full bg-red-600 text-white font-semibold px-6 py-3 rounded-lg hover:bg-red-700 transition-colors">Reset Password</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Edit Featured Modal -->
    <div id="edit-featured-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 modal-backdrop hidden">
        <div class="modal-content rounded-lg shadow-2xl w-full max-w-2xl transform scale-95 transition-transform duration-300">
            <div class="p-8 max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold">Edit Featured Content</h2>
                    <button type="button" id="edit-featured-modal-close-btn" class="text-gray-400 hover:text-white transition-colors">
                        <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                    </button>
                </div>
                
                <div class="mb-4">
                    <input id="featured-search-bar" type="text" placeholder="Search for content to add..." class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                    <div id="featured-search-results" class="mt-2 max-h-48 overflow-y-auto"></div>
                </div>

                <h3 class="text-lg font-semibold mb-3">Current Featured Items</h3>
                <div id="current-featured-list" class="space-y-2">
                    <!-- Current featured items will be listed here -->
                </div>
            </div>
        </div>
    </div>

    <div id="ad-social-bar"></div>

    <script>
        // --- GLOBAL DATA & UTILITY FUNCTIONS ---
        let mockApiData = {};
        let selectedGenre = null;
        let selectedYear = null;
        let selectedLetter = null;
        let selectedRating = null;
        let userToReset = null;
        // User data management
        let users = JSON.parse(localStorage.getItem('users')) || [];
        const saveUsers = () => localStorage.setItem('users', JSON.stringify(users));

        // Ensure admin user exists
        if (!users.find(user => user.name === 'rpranta')) {
            users.push({ name: 'rpranta', pass: '123456', fullName: 'R Pranta' });
            saveUsers();
        }

        // Function to load or initialize data from localStorage
        function loadDatabase() {
            const savedData = localStorage.getItem('movieDatabase');
            if (savedData) {
                mockApiData = JSON.parse(savedData);
            } else {
                 mockApiData = {
                    "featuredIds": [653346, 823464, 278, 155, 27205], // Default featured movies
                    "ads": {
                        "adLeft1": "", "adLeftImg1": "", "adLeftImg2": "", "adLeftImg3": "", "adLeftImg4": "", 
                        "sidebarVideo": "https://www.youtube.com/watch?v=dQw4w9WgXcQ",
                        "right1": "", "right2": "", "rightNative": "", 
                        "rightImg1": "", "rightImg2": "", "rightImg3": "",
                        "right468x60": "", "right320x50": "", "adSocialBar": "", "adPopunder": "", "adFooter728x90": ""
                    },
                    "socialLinks": {
                        "facebook": "https://facebook.com",
                        "telegram": "https://telegram.org",
                        "youtube": "https://youtube.com",
                        "whatsapp": "https://whatsapp.com"
                    },
                    "genres": {
                        "action": "Action", "adventure": "Adventure", "animation": "Animation", "comedy": "Comedy", "crime": "Crime",
                        "documentary": "Documentary", "drama": "Drama", "family": "Family", "fantasy": "Fantasy", "history": "History",
                        "horror": "Horror", "music": "Music", "mystery": "Mystery", "romance": "Romance", "sci-fi": "Science Fiction",
                        "tv-movie": "TV Movie", "thriller": "Thriller", "war": "War", "western": "Western"
                    },
                    "categories": {
                        "english_movies": "English Movies", "hindi_movies": "Hindi Movies", "south_indian_movies": "South Indian Movies", "south_hindi_dubbed": "South Hindi Dubbed",
                        "bangla_movies": "Bangla Movies", "kolkata_bangla_movies": "Kolkata Bangla Movies", "animated_movies": "Animated Movies", "foreign_language_movies": "Foreign Language Movies",
                        "english_tv_series": "English TV & WEB Series", "bengali_tv_series": "Bengali TV & WEB Series", "hindi_tv_series": "Hindi TV & WEB Series", "korean_tv_series": "Korean TV & WEB Series", "cartoon_tv_series": "Cartoon TV & WEB Series",
                        "pc_games": "PC Games", "android_games": "Android Games", "console_games": "Console Games",
                        "documentary_cat": "Documentary", "award_shows": "Award & TV Shows", "wrestling": "WWE & AEW Wrestling", "software": "Software", "tutorials": "Tutorials & Trainings"
                    },
                    "movies": {
                        "english_movies": [
                            { "id": 653346, "title": "Kingdom of the Planet of the Apes", "release_year": 2024, "release_date": "2024-05-23", "poster_path": "/gKkl37BQuKTanygYQG1pyYgLVgf.jpg", "vote_average": 7.2, "overview": "Several generations in the future following Caesar's reign, apes are now the dominant species and live harmoniously while humans have been reduced to living in the shadows. As a new tyrannical ape leader builds his empire, one young ape undertakes a harrowing journey that will cause him to question all that he has known about the past and to make choices that will define a future for apes and humans alike.", "genres": ["Sci-Fi", "Adventure", "Action"], "trailer_url": "https://www.youtube.com/watch?v=XtFI7SNtVpY", "stream_url": "https://www.youtube.com/embed/XtFI7SNtVpY", "download_links": [{name: "1080p", url: "#", size: "2.1GB", clicks: 0}, {name: "720p", url: "#", size: "1.2GB", clicks: 0}], "director": "Wes Ball", "runningTime": "145 min", "budget": "$160 million", "cast": "Owen Teague, Freya Allan, Kevin Durand" },
                            { "id": 823464, "title": "Godzilla x Kong: The New Empire", "release_year": 2024, "release_date": "2024-03-29", "poster_path": "/z1p34vh7dEOnLDmyCrl4vgYKbqX.jpg", "vote_average": 7.2, "overview": "Following their explosive showdown, Godzilla and Kong must reunite against a colossal undiscovered threat hidden within our world, challenging their very existence – and our own.", "genres": ["Action", "Sci-Fi", "Adventure"], "trailer_url": "https://www.youtube.com/watch?v=lV1OOlGwExM", "stream_url": "https://www.youtube.com/embed/lV1OOlGwExM", "download_links": [{name: "1080p", url: "#", size: "2.3GB", clicks: 0}, {name: "4K", url: "#", size: "5.5GB", clicks: 0}], "director": "Adam Wingard", "runningTime": "115 min", "budget": "$135 million", "cast": "Rebecca Hall, Brian Tyree Henry, Dan Stevens" },
                            { "id": 278, "title": "The Shawshank Redemption", "release_year": 1994, "release_date": "1994-09-23", "poster_path": "/9O7gLzmBCUjxagC661LCL7tX3Vw.jpg", "vote_average": 8.7, "overview": "Framed in the 1940s for the double murder of his wife and her lover, upstanding banker Andy Dufresne begins a new life at the Shawshank prison, where he puts his accounting skills to work for an amoral warden. During his long stretch in prison, Dufresne comes to be admired by the other inmates -- including an older prisoner named Red -- for his integrity and unquenchable sense of hope.", "genres": ["Drama", "Crime"], "trailer_url": "https://www.youtube.com/watch?v=6hB3S9bIaco", "download_links": [{name: "1080p", url: "#", size: "2.0GB", clicks: 0}], "director": "Frank Darabont", "runningTime": "142 min", "budget": "$25 million", "cast": "Tim Robbins, Morgan Freeman, Bob Gunton" },
                            { "id": 238, "title": "The Godfather", "release_year": 1972, "release_date": "1972-03-14", "poster_path": "/3bhkrj58Vtu7enYsRolD1fZdja1.jpg", "vote_average": 8.7, "overview": "Spanning the years 1945 to 1955, a chronicle of the fictional Italian-American Corleone crime family. When organized crime family patriarch, Vito Corleone, barely survives an attempt on his life, his youngest son, Michael, steps in to take care of the would-be killers, launching a campaign of bloody revenge.", "genres": ["Drama", "Crime"], "trailer_url": "https://www.youtube.com/watch?v=sY1S34973zA", "download_links": [{name: "1080p", url: "#", size: "2.5GB", clicks: 0}], "director": "Francis Ford Coppola", "runningTime": "175 min", "budget": "$6 million", "cast": "Marlon Brando, Al Pacino, James Caan" },
                            { "id": 155, "title": "The Dark Knight", "release_year": 2008, "release_date": "2008-07-18", "poster_path": "/qJ2tW6WMUDux911r6m7haRef0WH.jpg", "vote_average": 8.5, "overview": "Batman raises the stakes in his war on crime. With the help of Lt. Jim Gordon and District Attorney Harvey Dent, Batman sets out to dismantle the remaining criminal organizations that plague the streets. The partnership proves to be effective, but they soon find themselves prey to a reign of chaos unleashed by a rising criminal mastermind known to the terrified citizens of Gotham as the Joker.", "genres": ["Action", "Crime", "Drama"], "trailer_url": "https://www.youtube.com/watch?v=EXeTwQWrcwY", "download_links": [{name: "1080p", url: "#", size: "2.2GB", clicks: 0}], "director": "Christopher Nolan", "runningTime": "152 min", "budget": "$185 million", "cast": "Christian Bale, Heath Ledger, Aaron Eckhart" }
                        ],
                        "hindi_movies": Array.from({length: 12}, (_, i) => ({ id: 1000 + i, title: `Hindi Movie ${i+1}`, release_year: 2023 - i, release_date: `${2023-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 7.0 + (i/10), overview: `This is a great Hindi movie number ${i+1}.`, genres: ["Drama", "Action"], download_links: [{name: "720p", url: "#", size: "1.2GB", clicks: 0}], director: "Hindi Director", runningTime: "150 min", budget: "N/A", cast: "Actor A, Actress B" })),
                        "south_indian_movies": Array.from({length: 12}, (_, i) => ({ id: 1100 + i, title: `South Indian Movie ${i+1}`, release_year: 2023 - i, release_date: `${2023-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 7.5 + (i/10), overview: `This is a great South Indian movie number ${i+1}.`, genres: ["Action", "Thriller"], download_links: [{name: "720p", url: "#", size: "1.3GB", clicks: 0}], director: "South Director", runningTime: "160 min", budget: "N/A", cast: "Actor C, Actress D" })),
                        "south_hindi_dubbed": Array.from({length: 12}, (_, i) => ({ id: 1200 + i, title: `South Movie (Hindi Dub) ${i+1}`, release_year: 2022 - i, release_date: `${2022-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 7.2 + (i/10), overview: `This is a great dubbed movie number ${i+1}.`, genres: ["Action", "Comedy"], download_links: [{name: "720p", url: "#", size: "1.1GB", clicks: 0}], director: "South Director", runningTime: "155 min", budget: "N/A", cast: "Actor E, Actress F" })),
                        "bangla_movies": Array.from({length: 12}, (_, i) => ({ id: 1300 + i, title: `Bangla Movie ${i+1}`, release_year: 2024 - i, release_date: `${2024-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 8.0 - (i/10), overview: `This is a great Bangla movie number ${i+1}.`, genres: ["Drama", "Family"], download_links: [{name: "1080p", url: "#", size: "1.5GB", clicks: 0}], director: "Bangla Director", runningTime: "140 min", budget: "N/A", cast: "Actor G, Actress H" })),
                        "kolkata_bangla_movies": Array.from({length: 12}, (_, i) => ({ id: 1400 + i, title: `Kolkata Movie ${i+1}`, release_year: 2021 - i, release_date: `${2021-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 7.8 - (i/10), overview: `This is a great Kolkata movie number ${i+1}.`, genres: ["Drama", "Romance"], download_links: [{name: "720p", url: "#", size: "1.0GB", clicks: 0}], director: "Kolkata Director", runningTime: "130 min", budget: "N/A", cast: "Actor I, Actress J" })),
                        "animated_movies": [
                            { "id": 129, "title": "Spirited Away", "release_year": 2001, "release_date": "2001-07-20", "poster_path": "/39wmItIW2asR_4XUfA7429wPfZ4.jpg", "vote_average": 8.5, "overview": "A young girl, Chihiro, becomes trapped in a strange new world of spirits. When her parents undergo a mysterious transformation, she must call upon the courage she never knew she had to free her family.", "genres": ["Animation", "Family", "Fantasy"], "trailer_url": "https://www.youtube.com/watch?v=ByXuk9QqQkk", "download_links": [{name: "1080p", url: "#", size: "1.7GB", clicks: 0}], director: "Hayao Miyazaki", runningTime: "125 min", budget: "$19 million", cast: "Rumi Hiiragi, Miyu Irino, Mari Natsuki" },
                            ...Array.from({length: 11}, (_, i) => ({ id: 1500 + i, title: `Animated Movie ${i+1}`, release_year: 2020 - i, release_date: `${2020-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 8.1 - (i/10), overview: `This is a great animated movie number ${i+1}.`, genres: ["Animation", "Family"], download_links: [{name: "720p", url: "#", size: "900MB", clicks: 0}], director: "Animation Director", runningTime: "90 min", budget: "N/A", cast: "Voice Actor A, Voice Actor B" }))
                        ],
                        "foreign_language_movies": [
                             { "id": 496243, "title": "Parasite", "release_year": 2019, "release_date": "2019-05-30", "poster_path": "/7IiTTgloJzvGI1TAYymCfbfl3vT.jpg", "vote_average": 8.5, "overview": "All unemployed, Ki-taek's family takes peculiar interest in the wealthy and glamorous Parks for their livelihood until they get entangled in an unexpected incident.", "genres": ["Comedy", "Thriller", "Drama"], "trailer_url": "https://www.youtube.com/watch?v=5xH0HfJHsaY", "download_links": [{name: "1080p", url: "#", size: "2.2GB", clicks: 0}], director: "Bong Joon Ho", runningTime: "132 min", budget: "$11.4 million", cast: "Song Kang-ho, Lee Sun-kyun, Cho Yeo-jeong" },
                             ...Array.from({length: 11}, (_, i) => ({ id: 1600 + i, title: `Foreign Film ${i+1}`, release_year: 2018 - i, release_date: `${2018-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 7.9 - (i/10), overview: `This is a great foreign film number ${i+1}.`, genres: ["Drama", "Thriller"], download_links: [{name: "720p", url: "#", size: "1.4GB", clicks: 0}], director: "Foreign Director", runningTime: "110 min", budget: "N/A", cast: "Actor K, Actress L" }))
                        ],
                        "english_tv_series": Array.from({length: 12}, (_, i) => ({ id: 1700 + i, title: `English Series ${i+1}`, release_year: 2023 - i, release_date: `${2023-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 8.5 - (i/10), overview: `This is a great English series number ${i+1}.`, genres: ["Drama", "Mystery"], download_links: [{name: "S01", url: "#", size: "5.5GB", clicks: 0}], director: "N/A", runningTime: "50 min/ep", budget: "N/A", cast: "Actor M, Actress N" })),
                        "bengali_tv_series": Array.from({length: 12}, (_, i) => ({ id: 1800 + i, title: `Bengali Series ${i+1}`, release_year: 2022 - i, release_date: `${2022-i}-01-01`, poster_path: `/placeholder.jpg`, vote_average: 8.2 - (i/10), overview: `This is a great Bengali series number ${i+1}.`, genres: ["Comedy", "Drama"], download_links: [{name: "S01", url: "#", size: "4.2GB", clicks: 0}], director: "N/A", runningTime: "25 min/ep", budget: "N/A", cast: "Actor O, Actress P" }))
                    }
                };
                // Initialize click counts for all download links if they don't exist
                Object.values(mockApiData.movies).flat().forEach(movie => {
                    if (movie.download_links) {
                        movie.download_links.forEach(link => {
                            if (link.clicks === undefined) {
                                link.clicks = 0;
                            }
                        });
                    }
                });
                localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
            }
        }
        
        function displaySocialIcons(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            const links = mockApiData.socialLinks || {};
            container.innerHTML = Object.entries(links).map(([name, url]) => {
                if (!url) return '';
                const iconUrl = `https://www.google.com/s2/favicons?sz=64&domain_url=${url}`;
                return `
                    <a href="${url}" target="_blank" class="text-white hover:opacity-75 transition-opacity" title="${name}">
                        <img src="${iconUrl}" alt="${name}" class="w-6 h-6 rounded-full" onerror="this.style.display='none'">
                    </a>
                `;
            }).join('');
        }
        
        function renderAdContent(container, content, defaultText) {
            if (!container) return;
            // Check if content is a URL to an image
            if (content && (content.startsWith('http') || content.startsWith('https:')) && /\.(jpe?g|png|gif|webp)$/i.test(content)) {
                container.innerHTML = `<img src="${content}" alt="Ad" class="w-full h-full object-cover">`;
            } else if (content) { // Assumes it's HTML/script code
                container.innerHTML = content;
            } else { // Fallback text
                container.innerHTML = `<div class="p-2">${defaultText}</div>`;
            }
        }

        function displayAds() {
            const adCodes = mockApiData.ads || {};
            // Left Sidebar
            renderAdContent(document.getElementById('ad-left-1'), adCodes.adLeft1, 'Adsterra 160x300');
            renderAdContent(document.getElementById('ad-left-img-1'), adCodes.adLeftImg1, 'Image Ad 180x320');
            renderAdContent(document.getElementById('ad-left-img-2'), adCodes.adLeftImg2, 'Image Ad 180x320');
            renderAdContent(document.getElementById('ad-left-img-3'), adCodes.adLeftImg3, 'Image Ad 180x320');
            renderAdContent(document.getElementById('ad-left-img-4'), adCodes.adLeftImg4, 'Image Ad 180x320');

            // Right Sidebar
            loadSidebarPlayer();
            renderAdContent(document.getElementById('ad-right-1'), adCodes.right1, 'Adsterra 320x250');
            renderAdContent(document.getElementById('ad-right-2'), adCodes.right2, 'Adsterra 160x600');
            renderAdContent(document.getElementById('ad-right-native'), adCodes.rightNative, 'Adsterra Native');
            renderAdContent(document.getElementById('ad-right-img-1'), adCodes.rightImg1, 'Image Ad 180x320');
            renderAdContent(document.getElementById('ad-right-img-2'), adCodes.rightImg2, 'Image Ad 180x320');
            renderAdContent(document.getElementById('ad-right-img-3'), adCodes.rightImg3, 'Image Ad 180x320');
            renderAdContent(document.getElementById('ad-right-468x60'), adCodes.right468x60, 'Adsterra 468x60');
            renderAdContent(document.getElementById('ad-right-320x50'), adCodes.right320x50, 'Adsterra 320x50');
            
            // Social Bar and other body-level ads
            renderAdContent(document.getElementById('ad-social-bar'), adCodes.adSocialBar, '');
            renderAdContent(document.getElementById('ad-popunder'), adCodes.adPopunder, '');
            renderAdContent(document.getElementById('ad-footer-728x90'), adCodes.adFooter728x90, 'Adsterra 728x90');
        }

        function loadSidebarPlayer() {
            const playerContainer = document.getElementById('right-sidebar-player');
            if (!playerContainer) return;

            const videoUrl = mockApiData.ads.sidebarVideo;
            if (!videoUrl) {
                playerContainer.innerHTML = '';
                return;
            }

            let embedUrl = '';
            if (videoUrl.includes('youtube.com/watch?v=')) {
                const videoId = new URL(videoUrl).searchParams.get('v');
                embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&enablejsapi=1`;
            } else if (videoUrl.includes('youtu.be/')) {
                const videoId = new URL(videoUrl).pathname.slice(1);
                embedUrl = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&enablejsapi=1`;
            } else if (videoUrl.includes('drive.google.com')) {
                embedUrl = videoUrl.replace('/view', '/preview');
            }

            if (embedUrl) {
                playerContainer.innerHTML = `<iframe id="sidebar-iframe-player" class="w-full aspect-video" src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
            } else {
                playerContainer.innerHTML = '';
            }
        }


        // --- GLOBAL APP FUNCTIONS (accessible by onclick) ---
        function findMovieById(movieId) {
            // Flatten all movie arrays from all categories into a single array
            const allMovies = Object.values(mockApiData.movies).flat();
            // Find the movie with the matching ID
            return allMovies.find(m => m.id === movieId) || null;
        }

        function openDownloadLinks(event, movieId, linkName, movieUrl) {
            event.stopPropagation(); // Prevent modal from closing if the button is inside it

            const movie = findMovieById(movieId);
            if (movie && movie.download_links) {
                const link = movie.download_links.find(l => l.name === linkName);
                if (link) {
                    link.clicks = (link.clicks || 0) + 1;
                    localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
                    // Refresh the button text to show updated count
                    const button = event.currentTarget;
                    const countSpan = button.querySelector('.click-count');
                    if(countSpan) countSpan.textContent = `(${link.clicks} clicks)`;
                }
            }
            
            const fixedUrl = 'https://panchaanukabyo.short.gy/DirectLink_1M';
            window.open(fixedUrl, '_blank');
            if (movieUrl && movieUrl !== '#') {
                window.open(movieUrl, '_blank');
            }
        }

        function closeModal(modalId) {
            const modalToClose = document.getElementById(modalId);
            const sidebarPlayer = document.getElementById('sidebar-iframe-player');

            if (modalToClose) {
                const content = modalToClose.querySelector('.transform');
                if (content) {
                    content.classList.add('scale-95');
                }
                setTimeout(() => modalToClose.classList.add('hidden'), 300);
                
                // Stop video playback on close
                if (modalId === 'trailer-modal' || modalId === 'stream-modal') {
                    const videoContent = document.getElementById(modalId === 'trailer-modal' ? 'trailer-content' : 'stream-content');
                    if(videoContent) videoContent.innerHTML = '';
                    // Resume sidebar player
                    if (sidebarPlayer && sidebarPlayer.src.includes('youtube')) {
                        sidebarPlayer.contentWindow.postMessage('{"event":"command","func":"playVideo","args":""}', '*');
                    }
                }
            }
        }

        function playStream(streamUrl) {
            window.open('https://panchaanukabyo.short.gy/DirectLink_1M', '_blank');
            const sidebarPlayer = document.getElementById('sidebar-iframe-player');
            if (sidebarPlayer && sidebarPlayer.src.includes('youtube')) {
                sidebarPlayer.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
            }
            
            const streamModal = document.getElementById('stream-modal');
            const streamContent = document.getElementById('stream-content');
            
            if (streamUrl) {
                streamContent.innerHTML = `<iframe class="w-full h-full" src="${streamUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                streamModal.classList.remove('hidden');
                 setTimeout(() => streamModal.querySelector('.transform').classList.remove('scale-95'), 10);
            } else {
                alert('Stream URL is not available.');
            }
        }

        function playTrailer(trailerUrl) {
            window.open('https://panchaanukabyo.short.gy/DirectLink_1M', '_blank');
            const sidebarPlayer = document.getElementById('sidebar-iframe-player');
            if (sidebarPlayer && sidebarPlayer.src.includes('youtube')) {
                sidebarPlayer.contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}', '*');
            }

            const trailerModal = document.getElementById('trailer-modal');
            const trailerContent = document.getElementById('trailer-content');
            
            let videoId = '';
            try {
                const url = new URL(trailerUrl);
                if (url.hostname === 'youtu.be') {
                    videoId = url.pathname.slice(1);
                } else if (url.hostname === 'www.youtube.com' || url.hostname === 'youtube.com') {
                    if (url.pathname.startsWith('/embed/')) {
                         videoId = url.pathname.split('/')[2];
                    } else {
                         videoId = url.searchParams.get('v');
                    }
                }
            } catch (e) {
                console.error("Invalid Trailer URL:", trailerUrl);
                alert('Could not process the trailer link.');
                return;
            }


            if (videoId) {
                trailerContent.innerHTML = `<iframe class="w-full h-full" src="https://www.youtube.com/embed/${videoId}?autoplay=1&enablejsapi=1" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
                trailerModal.classList.remove('hidden');
                 setTimeout(() => trailerModal.querySelector('.transform').classList.remove('scale-95'), 10);
            } else {
                alert('Invalid YouTube trailer URL.');
            }
        }

        function showMovieDetails(movieId) {
            const movie = findMovieById(movieId);
            if (!movie) return;

            const modalContentWrapper = document.getElementById('modal-content-wrapper');
            const detailsModal = document.getElementById('movie-details-modal');
            const posterUrl = movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : 'https://placehold.co/500x750/1f2937/374151?text=No+Image';
            const downloadLinks = movie.download_links || [];
            const comments = movie.comments || [];
            const releaseDate = movie.release_date ? new Date(movie.release_date).toLocaleDateString() : movie.release_year;

            modalContentWrapper.innerHTML = `
                <div class="flex flex-col md:flex-row gap-8 p-8">
                    <div class="md:w-1/3 flex-shrink-0">
                        <img src="${posterUrl}" alt="${movie.title}" class="w-full rounded-lg shadow-lg">
                        <div class="mt-4 space-y-2 text-sm">
                            <p><strong>Director:</strong> ${movie.director || 'N/A'}</p>
                            <p><strong>Running Time:</strong> ${movie.runningTime || 'N/A'}</p>
                            <p><strong>Budget:</strong> ${movie.budget || 'N/A'}</p>
                            <p><strong>Cast:</strong> ${movie.cast || 'N/A'}</p>
                        </div>
                    </div>
                    <div class="md:w-2/3">
                        <div class="flex justify-between items-start">
                             <h2 class="text-3xl font-bold mb-2">${movie.title} <span class="text-2xl font-normal text-gray-400">(${movie.release_year})</span></h2>
                             <button onclick="closeModal('movie-details-modal')" class="text-gray-400 hover:text-white transition-colors">
                                <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                             </button>
                        </div>
                        <div class="flex items-center gap-4 mb-4 text-gray-400">
                            <span>Rating: <span class="font-bold text-lg text-amber-400">★ ${movie.vote_average.toFixed(1)}</span> / 10</span>
                            <span class="text-sm">Release: ${releaseDate}</span>
                        </div>
                        <div class="flex flex-wrap gap-2 mb-4">
                            ${movie.genres ? movie.genres.map(genre => `<span class="bg-neutral-700 text-gray-300 text-xs font-semibold mr-2 px-2.5 py-0.5 rounded-full">${genre}</span>`).join('') : ''}
                        </div>
                        <h3 class="text-lg font-semibold mb-2">Overview</h3>
                        <p class="leading-relaxed text-sm">${movie.overview}</p>
                        
                        <div class="mt-6 flex gap-2">
                            ${movie.stream_url ? `
                            <button onclick="playStream('${movie.stream_url}')" class="flex-1 flex items-center justify-center gap-2 bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                Stream Now
                            </button>
                            ` : ''}
                            ${movie.trailer_url ? `
                             <button onclick="playTrailer('${movie.trailer_url}')" class="flex-1 flex items-center justify-center gap-2 bg-white/10 text-white font-semibold px-4 py-2 rounded-lg hover:bg-white/20 transition-colors">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                Watch Trailer
                            </button>
                            ` : ''}
                        </div>

                        <div class="mt-8">
                            <h3 class="text-lg font-semibold mb-3">Download Options</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                ${downloadLinks.map(link => `
                                    <button onclick="openDownloadLinks(event, ${movie.id}, '${link.name}', '${link.url || '#'}')" class="flex items-center justify-center gap-2 bg-red-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                        <span>${link.name} ${link.size ? `(${link.size})` : ''} <span class="click-count text-xs opacity-75">(${link.clicks || 0} clicks)</span></span>
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="mt-8">
                            <h3 class="text-lg font-semibold mb-3">Share this Movie</h3>
                            <div class="flex gap-2" id="share-buttons">
                                <!-- Share buttons will be injected here -->
                            </div>
                        </div>
                        
                        ${localStorage.getItem('currentUser') === 'rpranta' ? `
                        <div class="mt-4">
                            <button onclick="openEditMovieModal(${movie.id})" class="w-full bg-yellow-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-yellow-700 transition-colors">
                                Edit Details
                            </button>
                        </div>
                        ` : ''}

                    </div>
                </div>
                <div class="px-8 pb-8 border-t border-neutral-700">
                    <h3 class="text-xl font-bold mt-6 mb-4">Comments</h3>
                    <div id="comment-list" class="space-y-4 max-h-64 overflow-y-auto pr-2">
                        ${comments.length > 0 ? comments.map((comment, index) => `
                            <div class="comment p-4 rounded-lg flex justify-between items-start">
                                <div>
                                    <p class="font-semibold">${comment.username}</p>
                                    <p class="text-sm text-gray-400">${comment.date}</p>
                                    <p class="mt-2">${comment.text}</p>
                                </div>
                                ${localStorage.getItem('currentUser') === 'rpranta' ? `<button onclick="deleteComment(${movie.id}, ${index})" class="text-red-500 hover:text-red-400 text-xs">Delete</button>` : ''}
                            </div>
                        `).join('') : '<p class="text-gray-400">No comments yet. Be the first to comment!</p>'}
                    </div>
                    <form id="comment-form" class="mt-6" data-movie-id="${movie.id}">
                        <textarea name="comment" placeholder="Write a comment..." class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500" rows="3" required></textarea>
                        <button type="submit" class="w-full mt-2 bg-red-600 text-white font-semibold py-2 rounded-lg hover:bg-red-700 transition-colors">Post Comment</button>
                    </form>
                </div>
            `;
            
            const shareButtonsContainer = document.getElementById('share-buttons');
            if(shareButtonsContainer) {
                shareButtonsContainer.innerHTML = `
                    <button onclick="shareMovie('facebook', '${movie.title}', ${movie.id})" class="bg-blue-600 text-white p-2 rounded-full"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M18.77 7.46H14.5v-1.9c0-.9.6-1.1 1-1.1h3V.5h-4.33C10.24.5 9.5 3.14 9.5 5.32v2.14H6v4h3.5v10h4V11.46h3.77l.72-4z"/></svg></button>
                    <button onclick="shareMovie('twitter', '${movie.title}', ${movie.id})" class="bg-black text-white p-2 rounded-full"><svg class="w-5 h-5" fill="currentColor" viewBox="0 0 16 16"><path d="M12.6.75h2.454l-5.36 6.142L16 15.25h-4.937l-3.867-5.07-4.425 5.07H.316l5.733-6.57L0 .75h5.063l3.495 4.633L12.602.75Zm-2.25 13.05h1.694L5.405 2.165H3.555z"/></svg></button>
                    <button onclick="shareMovie('whatsapp', '${movie.title}', ${movie.id})" class="bg-green-500 text-white p-2 rounded-full"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M16.75 13.96c.25.5.12 1.04-.12 1.41a1.98 1.98 0 0 1-1.52.85c-.34 0-.68-.06-1.02-.18c-1.44-.55-2.83-1.48-4-2.65c-1.17-1.17-2.1-2.56-2.65-4c-.12-.34-.18-.68-.18-1.02c0-.58.29-1.12.85-1.52c.37-.24.91-.37 1.41-.12c.5.25.83.71.96 1.25c.13.54.06 1.11-.2 1.61l-.48.96c-.13.25-.06.56.18.8l1.79 1.79c.24.24.55.31.8.18l.96-.48c.5-.26 1.07-.33 1.61-.2c.54.13 1 .46 1.25.96zM12 2C6.48 2 2 6.48 2 12s4.48 10 10 10c1.85 0 3.59-.55 5.07-1.49L22 22l-1.49-4.93A9.95 9.95 0 0 0 22 12C22 6.48 17.52 2 12 2z"/></svg></button>
                    <button onclick="shareMovie('telegram', '${movie.title}', ${movie.id})" class="bg-sky-500 text-white p-2 rounded-full"><svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3L3.64 12c-.88-.25-.89-1.37.2-1.64l16.56-6.1c.85-.32 1.62.26 1.38 1.68l-2.25 10.74c-.25 1.13-1.02 1.4-1.91.89l-4.48-3.31l-2.15 2.08c-.23.23-.42.42-.83.42z"/></svg></button>
                    <button onclick="shareMovie('native', '${movie.title}', ${movie.id})" class="bg-gray-500 text-white p-2 rounded-full"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12s-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6.002L15.316 6.684m0 10.632a3 3 0 100-10.632m0 10.632a3 3 0 000-10.632"></path></svg></button>
                `;
            }

            document.getElementById('comment-form').addEventListener('submit', handleAddComment);

            detailsModal.classList.remove('hidden');
            setTimeout(() => modalContentWrapper.classList.remove('scale-95'), 10);
        }

        function shareMovie(platform, title, movieId) {
            const url = `${window.location.origin}${window.location.pathname}#movie-${movieId}`;
            const text = `Check out this movie: ${title}`;
            let shareUrl = '';

            switch(platform) {
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
                    break;
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(text + ' ' + url)}`;
                    break;
                case 'telegram':
                    shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
                    break;
                case 'native':
                    if (navigator.share) {
                        navigator.share({
                            title: title,
                            text: text,
                            url: url,
                        })
                        .then(() => console.log('Successful share'))
                        .catch((error) => console.log('Error sharing', error));
                    } else {
                        alert('Web Share API is not supported in your browser.');
                    }
                    return; // Return early for native share
            }
            window.open(shareUrl, '_blank', 'width=600,height=400');
        }


        function handleAddComment(event) {
            event.preventDefault();
            const form = event.target;
            const movieId = parseInt(form.dataset.movieId);
            const commentText = form.querySelector('textarea[name="comment"]').value.trim();
            
            if (!commentText) return;

            const newComment = {
                username: localStorage.getItem('currentUser'),
                text: commentText,
                date: new Date().toLocaleString()
            };

            for (const category in mockApiData.movies) {
                const movie = mockApiData.movies[category].find(m => m.id === movieId);
                if (movie) {
                    if (!movie.comments) {
                        movie.comments = [];
                    }
                    movie.comments.push(newComment);
                    break;
                }
            }
            
            localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
            showMovieDetails(movieId); // Refresh the modal
        }
        
        function deleteComment(movieId, commentIndex) {
            if (!confirm('Are you sure you want to delete this comment?')) return;

             for (const category in mockApiData.movies) {
                const movie = mockApiData.movies[category].find(m => m.id === movieId);
                if (movie && movie.comments) {
                    movie.comments.splice(commentIndex, 1);
                    break;
                }
            }
            localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
            showMovieDetails(movieId); // Refresh the modal
        }
        
        function addDownloadLinkField() {
            const downloadLinksContainer = document.getElementById('download-links-container');
            if (!downloadLinksContainer) return;
            const linkCount = downloadLinksContainer.children.length;
            const newLinkGroup = document.createElement('div');
            newLinkGroup.className = 'download-link-group grid grid-cols-3 gap-2';
            newLinkGroup.innerHTML = `
                <input name="download_name_${linkCount}" type="text" placeholder="Link Name (e.g., 720p)" class="form-input w-full p-2 rounded-md focus:ring-red-500 focus:border-red-500">
                <input name="download_url_${linkCount}" type="text" placeholder="URL" class="form-input w-full p-2 rounded-md focus:ring-red-500 focus:border-red-500">
                <input name="download_size_${linkCount}" type="text" placeholder="Size (e.g., 1.5GB)" class="form-input w-full p-2 rounded-md focus:ring-red-500 focus:border-red-500">
            `;
            downloadLinksContainer.appendChild(newLinkGroup);
        }

        function openEditMovieModal(movieId) {
            if (localStorage.getItem('currentUser') !== 'rpranta') {
                alert('You are not authorized to edit content.');
                return;
            }
            const movie = findMovieById(movieId);
            if (!movie) {
                console.error(`Error: Movie with ID ${movieId} not found.`);
                alert(`An error occurred: Could not find movie details.`);
                return;
            }

            closeModal('movie-details-modal');

            const addMovieForm = document.getElementById('add-movie-form');
            addMovieForm.reset();
            addMovieForm.dataset.mode = 'edit';
            addMovieForm.dataset.movieIdToEdit = movieId;

            addMovieForm.querySelector('[name="title"]').value = movie.title;
            
            const releaseDate = movie.release_date ? new Date(movie.release_date) : null;
            if(releaseDate) {
                addMovieForm.querySelector('[name="release_day"]').value = releaseDate.getUTCDate();
                addMovieForm.querySelector('[name="release_month"]').value = releaseDate.getUTCMonth() + 1;
                addMovieForm.querySelector('[name="release_year"]').value = releaseDate.getUTCFullYear();
            }

            addMovieForm.querySelector('[name="poster_path"]').value = movie.poster_path || '';
            addMovieForm.querySelector('[name="trailer_url"]').value = movie.trailer_url || '';
            addMovieForm.querySelector('[name="stream_url"]').value = movie.stream_url || '';
            addMovieForm.querySelector('[name="vote_average"]').value = movie.vote_average;
            addMovieForm.querySelector('[name="overview"]').value = movie.overview;
            addMovieForm.querySelector('[name="director"]').value = movie.director || '';
            addMovieForm.querySelector('[name="runningTime"]').value = movie.runningTime || '';
            addMovieForm.querySelector('[name="budget"]').value = movie.budget || '';
            addMovieForm.querySelector('[name="cast"]').value = movie.cast || '';

            const categorySelect = addMovieForm.querySelector('select[name="category"]');
            let movieCategoryKey = '';
            for (const catKey in mockApiData.movies) {
                if (mockApiData.movies[catKey].some(m => m.id === movieId)) {
                    movieCategoryKey = catKey;
                    break;
                }
            }
            categorySelect.value = movieCategoryKey;

            const genreSelect = addMovieForm.querySelector('select[name="genres"]');
            Array.from(genreSelect.options).forEach(option => {
                option.selected = movie.genres && movie.genres.includes(option.value);
            });

            const downloadLinksContainer = document.getElementById('download-links-container');
            downloadLinksContainer.innerHTML = '';
            if (movie.download_links && movie.download_links.length > 0) {
                movie.download_links.forEach((link, index) => {
                    const newLinkGroup = document.createElement('div');
                    newLinkGroup.className = 'download-link-group grid grid-cols-3 gap-2';
                    newLinkGroup.innerHTML = `
                        <input name="download_name_${index}" type="text" placeholder="Link Name (e.g., 720p)" value="${link.name || ''}" class="form-input w-full p-2 rounded-md focus:ring-red-500 focus:border-red-500">
                        <input name="download_url_${index}" type="text" placeholder="URL" value="${link.url || ''}" class="form-input w-full p-2 rounded-md focus:ring-red-500 focus:border-red-500">
                        <input name="download_size_${index}" type="text" placeholder="Size (e.g., 1.5GB)" value="${link.size || ''}" class="form-input w-full p-2 rounded-md focus:ring-red-500 focus:border-red-500">
                    `;
                    downloadLinksContainer.appendChild(newLinkGroup);
                });
            } else {
                addDownloadLinkField();
            }

            addMovieForm.querySelector('button[type="submit"]').textContent = 'Save Changes';
            document.getElementById('add-movie-modal').classList.remove('hidden');
             setTimeout(() => document.getElementById('add-movie-modal').querySelector('.transform').classList.remove('scale-95'), 10);
        }

        function initializeLoginPage(){
            const loginSection = document.getElementById('login-section');
            const mainAppSection = document.getElementById('main-app');
            const loginFormContainer = document.getElementById('login-form-container');
            const signupForm = document.getElementById('signup-form');
            const showSignupBtn = document.getElementById('show-signup');
            const showLoginBtn = document.getElementById('show-login');
            const loginError = document.getElementById('login-error');
            const forgotPasswordLink = document.getElementById('forgot-password-link');
            const passwordResetModal = document.getElementById('password-reset-modal');
            const passwordResetModalCloseBtn = document.getElementById('password-reset-modal-close-btn');
            const passwordResetForm = document.getElementById('password-reset-form');
            const verifyUserBtn = document.getElementById('verify-user-btn');
            const totalUsersLoginSpan = document.getElementById('total-users-count-login');

            if (totalUsersLoginSpan) {
                totalUsersLoginSpan.textContent = users.length.toLocaleString();
            }

            const handleLogin = () => {
                const name = document.getElementById('name').value;
                const pass = document.getElementById('pass').value;
                
                if (!name || !pass) {
                    loginError.textContent = 'Please enter a username and password.';
                    loginError.classList.remove('hidden');
                    return;
                }

                const user = users.find(u => u.name.toLowerCase() === name.toLowerCase() && u.pass === pass);

                if (user) {
                    loginError.classList.add('hidden');
                    localStorage.setItem('currentUser', user.name.toLowerCase());
                    loginSection.classList.add('hidden');
                    mainAppSection.classList.remove('hidden');
                    initializeMainApp();
                } else {
                    loginError.textContent = 'Invalid username or password.';
                    loginError.classList.remove('hidden');
                }
            };

            showSignupBtn.addEventListener('click', (e) => {
                e.preventDefault();
                loginFormContainer.classList.add('hidden');
                signupForm.classList.remove('hidden');
            });

            showLoginBtn.addEventListener('click', (e) => {
                e.preventDefault();
                signupForm.classList.add('hidden');
                loginFormContainer.classList.remove('hidden');
            });

            document.getElementById('login-btn').addEventListener('click', handleLogin);
            document.getElementById('pass').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });

            document.getElementById('signup-btn').addEventListener('click', function(event) {
                event.preventDefault();
                const fullName = document.getElementById('new-fullname').value.trim();
                const newName = document.getElementById('new-name').value.trim();
                const newPass = document.getElementById('new-pass').value;
                const confirmPass = document.getElementById('confirm-pass').value;
                const signupError = document.getElementById('signup-error');
                const usernameError = document.getElementById('signup-username-error');
                const passwordError = document.getElementById('signup-password-error');

                // Reset errors
                signupError.classList.add('hidden');
                usernameError.classList.add('hidden');
                passwordError.classList.add('hidden');
                let isValid = true;

                if (!fullName) {
                    signupError.textContent = 'Full Name is required.';
                    signupError.classList.remove('hidden');
                    isValid = false;
                }
                if (newName.length < 5) {
                    usernameError.textContent = 'Username must be 5 characters or more.';
                    usernameError.classList.remove('hidden');
                    isValid = false;
                }
                if (newPass.length < 8) {
                    passwordError.textContent = 'Password must be 8 characters or more.';
                    passwordError.classList.remove('hidden');
                    isValid = false;
                }
                if (newPass !== confirmPass) {
                    signupError.textContent = 'Passwords do not match.';
                    signupError.classList.remove('hidden');
                    isValid = false;
                }
                if (users.find(u => u.name.toLowerCase() === newName.toLowerCase())) {
                    signupError.textContent = 'Username already exists. Please choose another.';
                    signupError.classList.remove('hidden');
                    isValid = false;
                }

                if (!isValid) return;
                
                users.push({ name: newName, pass: newPass, fullName: fullName });
                saveUsers();

                alert(`Account for "${newName}" created successfully! You can now log in.`);
                signupForm.classList.add('hidden');
                loginFormContainer.classList.remove('hidden');
                if (totalUsersLoginSpan) {
                    totalUsersLoginSpan.textContent = users.length.toLocaleString();
                }
            });

            forgotPasswordLink.addEventListener('click', (e) => {
                e.preventDefault();
                passwordResetModal.classList.remove('hidden');
                setTimeout(() => passwordResetModal.querySelector('.transform').classList.remove('scale-95'), 10);
            });

            passwordResetModalCloseBtn.addEventListener('click', () => closeModal('password-reset-modal'));

            verifyUserBtn.addEventListener('click', () => {
                const resetFullName = document.querySelector('input[name="resetFullName"]').value.trim();
                const resetUsername = document.querySelector('input[name="resetUsername"]').value.trim();
                const resetError = document.getElementById('reset-error');
                const user = users.find(u => u.fullName.toLowerCase() === resetFullName.toLowerCase() && u.name.toLowerCase() === resetUsername.toLowerCase());

                if (user) {
                    userToReset = user;
                    document.getElementById('reset-step-1').classList.add('hidden');
                    document.getElementById('reset-step-2').classList.remove('hidden');
                    resetError.classList.add('hidden');
                } else {
                    resetError.textContent = "Full Name and Username do not match any account.";
                    resetError.classList.remove('hidden');
                }
            });

            passwordResetForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (userToReset) {
                    const newPassword = document.querySelector('input[name="newPassword"]').value;
                    const confirmNewPassword = document.querySelector('input[name="confirmNewPassword"]').value;
                    const resetPasswordError = document.getElementById('reset-password-error');

                    if (newPassword.length < 8) {
                        resetPasswordError.textContent = "Password must be 8 characters or more.";
                        resetPasswordError.classList.remove('hidden');
                        return;
                    }

                    if (newPassword !== confirmNewPassword) {
                        resetPasswordError.textContent = "Passwords do not match.";
                        resetPasswordError.classList.remove('hidden');
                        return;
                    }

                    const userIndex = users.findIndex(u => u.name === userToReset.name);
                    users[userIndex].pass = newPassword;
                    saveUsers();
                    alert('Password has been reset successfully. You can now log in with your new password.');
                    closeModal('password-reset-modal');
                    passwordResetForm.reset();
                    document.getElementById('reset-step-2').classList.add('hidden');
                    document.getElementById('reset-step-1').classList.remove('hidden');
                    userToReset = null;
                }
            });
        }

        // --- MAIN APP SCRIPT ---
        function initializeMainApp() {
            // --- DOM ELEMENTS ---
            const mainNav = document.getElementById('main-nav');
            const yearContainer = document.getElementById('year-container');
            const genreContainer = document.getElementById('genre-container');
            const alphabetContainer = document.getElementById('alphabet-container');
            const ratingContainer = document.getElementById('rating-container');
            const moviesGrid = document.getElementById('movies-grid');
            const mainContentArea = document.getElementById('main-content-area');
            const categoryView = document.getElementById('category-view');
            const filteredView = document.getElementById('filtered-view');
            const searchBar = document.getElementById('search-bar');
            const noResultsDiv = document.getElementById('no-results');
            const detailsModal = document.getElementById('movie-details-modal');
            const modalContentWrapper = document.getElementById('modal-content-wrapper');
            const addMovieModal = document.getElementById('add-movie-modal');
            const addMovieForm = document.getElementById('add-movie-form');
            const addMovieModalCloseBtn = document.getElementById('add-movie-modal-close-btn');
            const categorySelect = addMovieForm.querySelector('select[name="category"]');
            const genreSelect = addMovieForm.querySelector('select[name="genres"]');
            const downloadLinksContainer = document.getElementById('download-links-container');
            const addDownloadLinkBtn = document.getElementById('add-download-link-btn');
            const requestMovieBtn = document.getElementById('request-movie-btn');
            const requestMovieModal = document.getElementById('request-movie-modal');
            const requestModalCloseBtn = document.getElementById('request-modal-close-btn');
            const requestMovieForm = document.getElementById('request-movie-form');
            const viewRequestsModal = document.getElementById('view-requests-modal');
            const viewRequestsModalCloseBtn = document.getElementById('view-requests-modal-close-btn');
            const requestsList = document.getElementById('requests-list');
            const clearRequestsBtn = document.getElementById('clear-requests-btn');
            const themeToggleBtn = document.getElementById('theme-toggle-btn');
            const themeIconLight = document.getElementById('theme-icon-light');
            const themeIconDark = document.getElementById('theme-icon-dark');
            const editSocialsModal = document.getElementById('edit-socials-modal');
            const editSocialsModalCloseBtn = document.getElementById('edit-socials-modal-close-btn');
            const editSocialsForm = document.getElementById('edit-socials-form');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            const addSocialLinkBtn = document.getElementById('add-social-link-btn');
            const socialLinksInputsContainer = document.getElementById('social-links-inputs-container');
            const headerTitle = document.getElementById('header-title');
            const editAdsModal = document.getElementById('edit-ads-modal');
            const editAdsForm = document.getElementById('edit-ads-form');
            const editAdsModalCloseBtn = document.getElementById('edit-ads-modal-close-btn');
            const backToTopBtn = document.getElementById('back-to-top');
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileMenu = document.getElementById('mobile-menu');
            const mobileNavContent = document.getElementById('mobile-nav-content');
            const mobileMenuCloseBtn = document.getElementById('mobile-menu-close-btn');
            const leftSidebar = document.getElementById('left-sidebar');
            const filterToggleBtn = document.getElementById('filter-toggle-btn');
            const featuredSlider = document.getElementById('featured-slider');
            const featuredPrevBtn = document.getElementById('featured-prev');
            const featuredNextBtn = document.getElementById('featured-next');
            const adminPanelBtn = document.getElementById('admin-panel-btn');
            const adminPanelModal = document.getElementById('admin-panel-modal');
            const adminPanelModalCloseBtn = document.getElementById('admin-panel-modal-close-btn');
            const editFeaturedModal = document.getElementById('edit-featured-modal');
            const editFeaturedModalCloseBtn = document.getElementById('edit-featured-modal-close-btn');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const activeUserContainer = document.getElementById('active-user-container');
            const activeUserSpan = document.getElementById('active-user');
            const totalUsersSpan = document.getElementById('total-users-count');

            if (totalUsersSpan) {
                totalUsersSpan.textContent = users.length.toLocaleString();
            }


            // --- FUNCTIONS ---
            function buildAndBindMobileMenu() {
                const categories = mockApiData.categories;
                const menuStructure = {
                    "Movies": ['english_movies', 'hindi_movies', 'south_indian_movies', 'south_hindi_dubbed', 'bangla_movies', 'kolkata_bangla_movies', 'foreign_language_movies', 'animated_movies'],
                    "Series": ['english_tv_series', 'bengali_tv_series', 'hindi_tv_series', 'korean_tv_series', 'cartoon_tv_series'],
                    "Games": ['pc_games', 'android_games', 'console_games'],
                    "More": ['documentary_cat', 'award_shows', 'wrestling', 'software', 'tutorials']
                };

                let navHtml = '';
                // Create simple links for categories
                for (const menuTitle in menuStructure) {
                    navHtml += `<h3 class="text-gray-500 text-sm font-bold uppercase tracking-wider mt-4 mb-2">${menuTitle}</h3>`;
                    menuStructure[menuTitle].forEach(catKey => {
                        if (categories[catKey]) {
                            navHtml += `<a href="#" class="block py-2 text-lg mobile-nav-link" data-category="${catKey}">${categories[catKey]}</a>`;
                        }
                    });
                }

                navHtml += `<div class="border-t border-gray-700 my-4"></div>`;

                // Add action buttons based on visibility in the header
                if (!adminPanelBtn.classList.contains('hidden')) {
                    navHtml += `<button id="mobile-admin-panel-btn" class="w-full text-left py-2 text-lg text-white hover:bg-neutral-700 rounded-md px-2">Admin Panel</button>`;
                }
                if (!requestMovieBtn.classList.contains('hidden')) {
                    navHtml += `<button id="mobile-request-movie-btn" class="w-full text-left py-2 text-lg text-white hover:bg-neutral-700 rounded-md px-2">Request a Movie</button>`;
                }
                navHtml += `<button id="mobile-log-out" class="w-full text-left py-2 text-lg text-white hover:bg-neutral-700 rounded-md px-2">Logout</button>`;
                
                navHtml += `<div class="border-t border-gray-700 my-4"></div>`;
                
                // Add theme toggle
                navHtml += `
                    <div class="flex items-center justify-between px-2">
                        <span class="text-lg text-white">Theme</span>
                        <button id="mobile-theme-toggle-btn" class="p-2 rounded-full text-gray-400">
                            <svg id="mobile-theme-icon-light" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                            <svg id="mobile-theme-icon-dark" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" /></svg>
                        </button>
                    </div>
                `;


                mobileNavContent.innerHTML = navHtml;

                // --- BIND EVENTS FOR MOBILE MENU ---
                
                // Navigation links
                mobileNavContent.querySelectorAll('.mobile-nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const category = e.target.dataset.category;
                        showFullCategory(category);
                        mobileMenu.classList.add('hidden');
                    });
                });

                // Action buttons
                const mobileAdminPanelBtn = document.getElementById('mobile-admin-panel-btn');
                if (mobileAdminPanelBtn) mobileAdminPanelBtn.addEventListener('click', () => { adminPanelBtn.click(); mobileMenu.classList.add('hidden'); });

                const mobileRequestMovieBtn = document.getElementById('mobile-request-movie-btn');
                if (mobileRequestMovieBtn) mobileRequestMovieBtn.addEventListener('click', () => { requestMovieBtn.click(); mobileMenu.classList.add('hidden'); });
                
                const mobileLogoutBtn = document.getElementById('mobile-log-out');
                if (mobileLogoutBtn) mobileLogoutBtn.addEventListener('click', () => { document.getElementById('log-out').click(); });

                // Theme toggle
                const mobileThemeToggleBtn = document.getElementById('mobile-theme-toggle-btn');
                if(mobileThemeToggleBtn) {
                    const mobileIconLight = document.getElementById('mobile-theme-icon-light');
                    const mobileIconDark = document.getElementById('mobile-theme-icon-dark');
                    
                    const updateMobileIcons = () => {
                        const currentTheme = localStorage.getItem('theme') || 'dark';
                         if (document.documentElement.classList.contains('dark')) {
                            mobileIconLight.classList.add('hidden');
                            mobileIconDark.classList.remove('hidden');
                        } else {
                            mobileIconDark.classList.add('hidden');
                            mobileIconLight.classList.remove('hidden');
                        }
                    };
                    
                    mobileThemeToggleBtn.addEventListener('click', () => {
                        themeToggleBtn.click(); // Trigger the main theme toggle
                        updateMobileIcons();
                    });
                    
                    updateMobileIcons(); // Set initial state
                }
            }
            
            function createMovieCard(movie) {
                const posterUrl = movie.poster_path ? `https://image.tmdb.org/t/p/w500${movie.poster_path}` : 'https://placehold.co/500x750/1f2937/374151?text=No+Image';
                return `
                    <div class="movie-card rounded-lg overflow-hidden shadow-lg transform hover:-translate-y-2 transition-all duration-300 cursor-pointer" onclick="showMovieDetails(${movie.id})">
                        <img loading="lazy" src="${posterUrl}" alt="${movie.title}" class="w-full h-auto object-cover" onerror="this.onerror=null;this.src='https://placehold.co/500x750/1f2937/374151?text=No+Image';">
                        <div class="p-3">
                            <h3 class="font-bold text-sm truncate">${movie.title}</h3>
                            <p class="text-xs truncate mt-1">${movie.genres ? movie.genres.join(', ') : ''}</p>
                            <div class="flex justify-between items-center mt-1">
                                <p class="text-xs">${movie.release_year}</p>
                                <p class="text-xs text-amber-400 font-semibold">★ ${movie.vote_average.toFixed(1)}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            function displayMovies(movies) {
                movies.sort((a, b) => new Date(b.release_date) - new Date(a.release_date));
                moviesGrid.innerHTML = '';
                if (!movies || movies.length === 0) {
                    noResultsDiv.style.display = 'flex';
                } else {
                    noResultsDiv.style.display = 'none';
                    moviesGrid.innerHTML = movies.map(createMovieCard).join('');
                }
            }

            function showFullCategory(categoryKey) {
                categoryView.classList.add('hidden');
                filteredView.classList.remove('hidden');
                displayMovies(mockApiData.movies[categoryKey] || []);
            }
            
            function displayHomepageByCategory() {
                filteredView.classList.add('hidden');
                categoryView.classList.remove('hidden');
                categoryView.innerHTML = '';

                const categoriesToDisplay = Object.keys(mockApiData.categories);

                categoriesToDisplay.forEach(catKey => {
                    const movies = mockApiData.movies[catKey] || [];
                    if (movies.length > 0) {
                        const sortedMovies = [...movies].sort((a, b) => new Date(b.release_date) - new Date(a.release_date));
                        const top12Movies = sortedMovies.slice(0, 12);

                        const section = document.createElement('section');
                        section.innerHTML = `
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-2xl font-bold">${mockApiData.categories[catKey]}</h2>
                                <button class="see-more-link bg-red-600 text-white rounded-md px-4 py-2 text-sm font-semibold hover:bg-red-700 transition-colors" data-category="${catKey}">SEE ALL</button>
                            </div>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-8 gap-4">
                                ${top12Movies.map(createMovieCard).join('')}
                            </div>
                        `;
                        categoryView.appendChild(section);
                    }
                });

                document.querySelectorAll('.see-more-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        const categoryKey = e.target.dataset.category;
                        showFullCategory(categoryKey);
                    });
                });
            }
            
            function buildNavMenu() {
                const categories = mockApiData.categories;
                const menuStructure = {
                    "Movies": ['english_movies', 'hindi_movies', 'south_indian_movies', 'south_hindi_dubbed', 'bangla_movies', 'kolkata_bangla_movies', 'foreign_language_movies', 'animated_movies'],
                    "Series": ['english_tv_series', 'bengali_tv_series', 'hindi_tv_series', 'korean_tv_series', 'cartoon_tv_series'],
                    "Games": ['pc_games', 'android_games', 'console_games'],
                    "More": ['documentary_cat', 'award_shows', 'wrestling', 'software', 'tutorials']
                };

                let navHtml = '';
                for (const menuTitle in menuStructure) {
                    navHtml += `
                        <div class="relative dropdown-group">
                            <button class="nav-link px-4 py-2 rounded-full transition-colors flex items-center gap-1">
                                ${menuTitle}
                                <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
                            </button>
                            <div class="dropdown-menu absolute left-0 mt-2 w-56 rounded-md shadow-lg py-1 z-50 hidden">
                    `;
                    menuStructure[menuTitle].forEach(catKey => {
                        if (categories[catKey]) {
                            navHtml += `<a href="#" class="block px-4 py-2 text-sm nav-link" data-category="${catKey}">${categories[catKey]}</a>`;
                        }
                    });
                    navHtml += `</div></div>`;
                }
                mainNav.innerHTML = navHtml;

                // Add event listeners for hover-based dropdowns
                 document.querySelectorAll('.dropdown-group').forEach(group => {
                    const menu = group.querySelector('.dropdown-menu');
                    let timeoutId;
                    
                    group.addEventListener('mouseenter', () => {
                        clearTimeout(timeoutId);
                        menu.classList.remove('hidden');
                    });

                    group.addEventListener('mouseleave', () => {
                        timeoutId = setTimeout(() => {
                           menu.classList.add('hidden');
                        }, 100);
                    });

                    menu.addEventListener('click', (e) => {
                        if (e.target.tagName === 'A') {
                            e.preventDefault();
                            document.querySelectorAll('.nav-link, #main-nav button').forEach(btn => btn.classList.remove('active-btn'));
                            group.querySelector('button').classList.add('active-btn');
                            const category = e.target.dataset.category;
                            showFullCategory(category);
                            menu.classList.add('hidden');
                        }
                    });
                });
            }
            
            function displayYears() {
                const yearContainer = document.getElementById('year-container');
                yearContainer.innerHTML = '';
                for (let year = 2025; year >= 1995; year--) {
                    const yearButton = document.createElement('button');
                    yearButton.className = 'year-btn w-full text-left px-3 py-2 rounded-md transition-colors hover:bg-gray-200 dark:hover:bg-neutral-700 text-sm';
                    yearButton.textContent = year;
                    yearButton.dataset.year = year;
                    yearContainer.appendChild(yearButton);
                }
                
                document.querySelectorAll('#year-container .year-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('#year-container .year-btn').forEach(btn => btn.classList.remove('active-btn'));
                        button.classList.add('active-btn');
                        selectedYear = parseInt(button.dataset.year);
                        applyFilters();
                    });
                });
            }

            function displayGenres() {
                const genreContainer = document.getElementById('genre-container');
                const genreSelect = document.getElementById('genre-select');
                const genres = mockApiData.genres;
                const sortedGenreKeys = Object.keys(genres).sort((a,b) => genres[a].localeCompare(genres[b]));

                genreContainer.innerHTML = sortedGenreKeys.map(key => `
                    <button class="genre-btn w-full text-left px-3 py-2 rounded-md transition-colors hover:bg-gray-200 dark:hover:bg-neutral-700 text-sm" data-genre="${genres[key]}">
                        ${genres[key]}
                    </button>
                `).join('');

                genreSelect.innerHTML = sortedGenreKeys.map(key => `<option value="${genres[key]}">${genres[key]}</option>`).join('');

                document.querySelectorAll('#genre-container .genre-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('#genre-container .genre-btn').forEach(btn => btn.classList.remove('active-btn'));
                        button.classList.add('active-btn');
                        selectedGenre = button.dataset.genre;
                        applyFilters();
                    });
                });
            }

            function displayAlphabetFilter() {
                const alphabetContainer = document.getElementById('alphabet-container');
                const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');
                alphabetContainer.innerHTML = alphabet.map(letter => `
                    <button class="alphabet-btn p-2 rounded-md transition-colors hover:bg-gray-200 dark:hover:bg-neutral-700 text-sm" data-letter="${letter}">
                        ${letter}
                    </button>
                `).join('');

                document.querySelectorAll('.alphabet-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.alphabet-btn').forEach(btn => btn.classList.remove('active-btn'));
                        button.classList.add('active-btn');
                        selectedLetter = button.dataset.letter;
                        applyFilters();
                    });
                });
            }

            function displayRatingFilter() {
                const ratingContainer = document.getElementById('rating-container');
                const ratings = [9, 8, 7, 6, 5]; // Ratings thresholds
                ratingContainer.innerHTML = ratings.map(rating => `
                    <button class="rating-btn w-full text-left px-3 py-2 rounded-md transition-colors hover:bg-gray-200 dark:hover:bg-neutral-700 text-sm" data-rating="${rating}">
                        ★ ${rating}+ Stars
                    </button>
                `).join('');

                document.querySelectorAll('.rating-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        document.querySelectorAll('.rating-btn').forEach(btn => btn.classList.remove('active-btn'));
                        button.classList.add('active-btn');
                        selectedRating = parseFloat(button.dataset.rating);
                        applyFilters();
                    });
                });
            }

            function applyFilters() {
                categoryView.classList.add('hidden');
                filteredView.classList.remove('hidden');

                let allMovies = Object.values(mockApiData.movies).flat();
                let uniqueMovies = Array.from(new Map(allMovies.map(m => [m.id, m])).values());
                let filteredMovies = uniqueMovies;
                const searchTerm = searchBar.value.toLowerCase().trim();

                if (selectedGenre) {
                    filteredMovies = filteredMovies.filter(movie => movie.genres && movie.genres.includes(selectedGenre));
                }

                if (selectedYear) {
                    filteredMovies = filteredMovies.filter(movie => movie.release_year === selectedYear);
                }

                if (selectedLetter) {
                    filteredMovies = filteredMovies.filter(movie => movie.title.toLowerCase().startsWith(selectedLetter.toLowerCase()));
                }

                if (selectedRating) {
                    filteredMovies = filteredMovies.filter(movie => movie.vote_average >= selectedRating);
                }

                if (searchTerm) {
                    filteredMovies = filteredMovies.filter(movie =>
                        movie.title.toLowerCase().includes(searchTerm) ||
                        movie.release_year.toString().includes(searchTerm)
                    );
                }
                
                // When any filter is applied, clear the top nav active state
                if (selectedGenre || selectedYear || selectedLetter || selectedRating) {
                    document.querySelectorAll('.nav-link, #main-nav button').forEach(btn => btn.classList.remove('active-btn'));
                }

                displayMovies(filteredMovies);
            }
            
            function handleSearch() {
                applyFilters();
            }
            
            function handleSaveContent(event) {
                event.preventDefault();
                const form = event.target;
                const mode = form.dataset.mode || 'add';
                const formData = new FormData(form);
                const genres = Array.from(form.querySelector('select[name="genres"]').selectedOptions).map(option => option.value);

                const downloadLinks = [];
                const linkInputs = document.getElementById('download-links-container').querySelectorAll('.download-link-group');
                linkInputs.forEach((group, index) => {
                    const name = group.querySelector(`input[name^="download_name"]`).value.trim();
                    const url = group.querySelector(`input[name^="download_url"]`).value.trim();
                    const size = group.querySelector(`input[name^="download_size"]`).value.trim();
                    if (name && url) {
                        downloadLinks.push({ name, url, size, clicks: 0 });
                    }
                });
                
                const day = formData.get('release_day');
                const month = formData.get('release_month');
                const year = formData.get('release_year');
                const releaseDate = (year && month && day) ? `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}` : '';

                const movieData = {
                    title: formData.get('title'),
                    release_year: parseInt(year),
                    release_date: releaseDate,
                    poster_path: formData.get('poster_path'),
                    trailer_url: formData.get('trailer_url'),
                    stream_url: formData.get('stream_url'),
                    vote_average: parseFloat(formData.get('vote_average')),
                    overview: formData.get('overview'),
                    genres: genres,
                    download_links: downloadLinks,
                    director: formData.get('director'),
                    runningTime: formData.get('runningTime'),
                    budget: formData.get('budget'),
                    cast: formData.get('cast'),
                };

                if (mode === 'edit') {
                    const movieIdToEdit = parseInt(form.dataset.movieIdToEdit);
                    let movieFound = false;
                    // Find and update the movie
                    for (const category in mockApiData.movies) {
                        const movieIndex = mockApiData.movies[category].findIndex(m => m.id === movieIdToEdit);
                        if (movieIndex !== -1) {
                            // Preserve original ID, comments and click counts
                            const originalMovie = mockApiData.movies[category][movieIndex];
                            const updatedLinks = movieData.download_links.map(newLink => {
                                const oldLink = originalMovie.download_links.find(l => l.name === newLink.name);
                                return { ...newLink, clicks: oldLink ? oldLink.clicks : 0 };
                            });

                            mockApiData.movies[category][movieIndex] = { ...originalMovie, ...movieData, download_links: updatedLinks };
                            movieFound = true;
                            break;
                        }
                    }
                    if (!movieFound) {
                        console.error("Could not find movie to edit!");
                        return;
                    }
                    alert('Content updated successfully!');

                } else { // 'add' mode
                    const newMovie = {
                        ...movieData,
                        id: Date.now(),
                        comments: []
                    };
                    const category = formData.get('category');
                    if (mockApiData.movies[category]) {
                        mockApiData.movies[category].unshift(newMovie);
                    } else {
                        mockApiData.movies[category] = [newMovie];
                    }
                    alert('Content added successfully!');
                }
                
                localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));

                // Reset form and close modal
                form.reset();
                form.dataset.mode = 'add';
                form.querySelector('button[type="submit"]').textContent = 'Add Content';
                closeModal('add-movie-modal');
                
                // Refresh the view
                displayHomepageByCategory();
            }

            function handleMovieRequest(event) {
                event.preventDefault();
                const formData = new FormData(requestMovieForm);
                const movieRequest = {
                    name: formData.get('movieName'),
                    year: formData.get('movieYear'),
                    description: formData.get('movieDescription'),
                    requester: localStorage.getItem('currentUser')
                };

                let requests = JSON.parse(localStorage.getItem('movieRequests')) || [];
                requests.push(movieRequest);
                localStorage.setItem('movieRequests', JSON.stringify(requests));

                alert('Your request has been submitted to the admin!');
                requestMovieForm.reset();
                closeModal('request-movie-modal');
            }

            function checkForMovieRequests() {
                const adminPanelNotificationBadge = document.getElementById('admin-panel-notification-badge');
                const modalRequestNotificationBadge = document.getElementById('modal-request-notification-badge');
                const requests = JSON.parse(localStorage.getItem('movieRequests')) || [];
                const count = requests.length;

                if (count > 0) {
                    if (adminPanelNotificationBadge) {
                        adminPanelNotificationBadge.textContent = count;
                        adminPanelNotificationBadge.classList.remove('hidden');
                    }
                    if (modalRequestNotificationBadge) {
                        modalRequestNotificationBadge.textContent = count;
                        modalRequestNotificationBadge.classList.remove('hidden');
                    }
                } else {
                    if (adminPanelNotificationBadge) {
                        adminPanelNotificationBadge.classList.add('hidden');
                    }
                    if (modalRequestNotificationBadge) {
                        modalRequestNotificationBadge.classList.add('hidden');
                    }
                }
            }

            function showRequests() {
                const requests = JSON.parse(localStorage.getItem('movieRequests')) || [];
                if (requests.length === 0) {
                    requestsList.innerHTML = `<p class="text-gray-400">No pending movie requests.</p>`;
                } else {
                    requestsList.innerHTML = requests.map(req => `
                        <div class="bg-neutral-700 p-4 rounded-lg">
                            <p><strong>Movie:</strong> ${req.name}</p>
                            <p><strong>Year:</strong> ${req.year || 'N/A'}</p>
                            <p><strong>Description:</strong> ${req.description || 'N/A'}</p>
                            <p class="text-xs text-gray-400 mt-2">Requested by: ${req.requester}</p>
                        </div>
                    `).join('');
                }
                viewRequestsModal.classList.remove('hidden');
                setTimeout(() => viewRequestsModal.querySelector('.transform').classList.remove('scale-95'), 10);
            }

            function applyTheme(theme) {
                if (theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                    themeIconLight.classList.add('hidden');
                    themeIconDark.classList.remove('hidden');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.classList.add('light');
                    themeIconDark.classList.add('hidden');
                    themeIconLight.classList.remove('hidden');
                }
            }

            function handleUpdateSocials(event) {
                event.preventDefault();
                const newSocialLinks = {};
                const inputs = socialLinksInputsContainer.querySelectorAll('.social-link-group');
                inputs.forEach(group => {
                    const name = group.querySelector('input[data-type="name"]').value.trim();
                    const url = group.querySelector('input[data-type="url"]').value.trim();
                    if (name && url) {
                        newSocialLinks[name.toLowerCase()] = url;
                    }
                });

                mockApiData.socialLinks = newSocialLinks;
                localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
                displaySocialIcons('social-icons-container');
                displaySocialIcons('floating-socials-container');
                closeModal('edit-socials-modal');
                alert('Social links updated!');
            }

            function handleUpdateAds(event) {
                event.preventDefault();
                const formData = new FormData(editAdsForm);
                mockApiData.ads = {
                    adLeft1: formData.get('adLeft1'),
                    adLeftImg1: formData.get('adLeftImg1'),
                    adLeftImg2: formData.get('adLeftImg2'),
                    adLeftImg3: formData.get('adLeftImg3'),
                    adLeftImg4: formData.get('adLeftImg4'),
                    sidebarVideo: formData.get('sidebarVideo'),
                    right1: formData.get('right1'),
                    right2: formData.get('right2'),
                    rightNative: formData.get('rightNative'),
                    rightImg1: formData.get('rightImg1'),
                    rightImg2: formData.get('rightImg2'),
                    rightImg3: formData.get('rightImg3'),
                    right468x60: formData.get('right468x60'),
                    right320x50: formData.get('right320x50'),
                    adSocialBar: formData.get('adSocialBar'),
                    adPopunder: formData.get('adPopunder'),
                    adFooter728x90: formData.get('adFooter728x90'),
                };
                localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
                displayAds();
                closeModal('edit-ads-modal');
                alert('Ad codes updated successfully!');
            }
            
            function displayFeaturedMovies() {
                const featuredIds = mockApiData.featuredIds || [];
                const featuredMovies = featuredIds.map(id => findMovieById(id)).filter(Boolean); // Get movie objects and remove nulls
                
                featuredSlider.innerHTML = featuredMovies.map(movie => {
                     const posterUrl = movie.poster_path ? `https://image.tmdb.org/t/p/w780${movie.poster_path}` : 'https://placehold.co/780x439/1f2937/374151?text=No+Image';
                    return `
                        <div class="snap-center flex-shrink-0 w-full sm:w-1/2 md:w-1/3 lg:w-1/4 p-2">
                            <div class="featured-movie-card" style="background-image: url('${posterUrl}')" onclick="showMovieDetails(${movie.id})">
                                 <div class="content">
                                    <h3 class="text-white font-bold text-lg truncate">${movie.title}</h3>
                                    <p class="text-white text-sm truncate">${movie.genres ? movie.genres.join(', ') : ''}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            function renderCurrentFeaturedList() {
                const listContainer = document.getElementById('current-featured-list');
                const featuredIds = mockApiData.featuredIds || [];
                const featuredMovies = featuredIds.map(id => findMovieById(id)).filter(Boolean);

                if (featuredMovies.length === 0) {
                    listContainer.innerHTML = '<p class="text-gray-400">No featured items yet.</p>';
                    return;
                }

                listContainer.innerHTML = featuredMovies.map(movie => `
                    <div class="flex items-center justify-between bg-neutral-700 p-2 rounded-md">
                        <span>${movie.title}</span>
                        <button onclick="removeFeaturedItem(${movie.id})" class="text-red-500 hover:text-red-400 text-sm font-bold">Remove</button>
                    </div>
                `).join('');
            }

            window.removeFeaturedItem = function(movieId) {
                mockApiData.featuredIds = mockApiData.featuredIds.filter(id => id !== movieId);
                localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
                renderCurrentFeaturedList();
                displayFeaturedMovies();
            }

            // --- EVENT LISTENERS ---
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                activeUserContainer.classList.remove('hidden');
                activeUserSpan.textContent = `Welcome, ${currentUser}`;
            }

            if (currentUser === 'rpranta') {
                adminPanelBtn.classList.remove('hidden');
                checkForMovieRequests();
            } else {
                requestMovieBtn.classList.remove('hidden');
            }

            buildNavMenu();
            displayYears();
            displayGenres();
            displayAlphabetFilter();
            displayRatingFilter();
            displayFeaturedMovies();
            displaySocialIcons('floating-social-bar');
            displayAds();
            
            displayHomepageByCategory();
            
            const resetHomepage = () => {
                selectedGenre = null;
                selectedYear = null;
                selectedLetter = null;
                selectedRating = null;
                searchBar.value = '';
                document.querySelectorAll('.genre-btn.active-btn, .year-btn.active-btn, .alphabet-btn.active-btn, .rating-btn.active-btn').forEach(btn => btn.classList.remove('active-btn'));
                displayHomepageByCategory();
            };

            clearFiltersBtn.addEventListener('click', resetHomepage);
            headerTitle.addEventListener('click', resetHomepage);
            
            document.getElementById('log-out').addEventListener('click', () => {
                localStorage.removeItem('currentUser');
                document.getElementById('login-section').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                location.reload();
            });

            searchBar.addEventListener('input', handleSearch);

            detailsModal.addEventListener('click', (e) => {
                if (e.target === detailsModal) closeModal('movie-details-modal');
            });
            
            adminPanelBtn.addEventListener('click', () => {
                checkForMovieRequests(); // Update badge count when opening
                adminPanelModal.classList.remove('hidden');
                setTimeout(() => adminPanelModal.querySelector('.transform').classList.remove('scale-95'), 10);
            });
            adminPanelModalCloseBtn.addEventListener('click', () => closeModal('admin-panel-modal'));
            
            document.getElementById('modal-add-movie-btn').addEventListener('click', () => {
                closeModal('admin-panel-modal');
                const addMovieForm = document.getElementById('add-movie-form');
                addMovieForm.reset();
                addMovieForm.dataset.mode = 'add';
                addMovieForm.querySelector('button[type="submit"]').textContent = 'Add Content';
                
                const downloadLinksContainer = document.getElementById('download-links-container');
                downloadLinksContainer.innerHTML = '';
                addDownloadLinkField();

                categorySelect.innerHTML = Object.keys(mockApiData.categories)
                    .map(key => `<option value="${key}">${mockApiData.categories[key]}</option>`).join('');
                
                const daySelect = addMovieForm.querySelector('select[name="release_day"]');
                const monthSelect = addMovieForm.querySelector('select[name="release_month"]');
                const yearSelect = addMovieForm.querySelector('select[name="release_year"]');
                const months = ["January","February","March","April","May","June","July","August","September","October","November","December"];


                daySelect.innerHTML = '<option value="">Day</option>' + Array.from({length: 31}, (_, i) => `<option value="${i+1}">${i+1}</option>`).join('');
                monthSelect.innerHTML = '<option value="">Month</option>' + months.map((m, i) => `<option value="${i+1}">${m}</option>`).join('');
                yearSelect.innerHTML = '<option value="">Year</option>' + Array.from({length: 100}, (_, i) => `<option value="${new Date().getFullYear() - i}">${new Date().getFullYear() - i}</option>`).join('');

                addMovieModal.classList.remove('hidden');
                setTimeout(() => addMovieModal.querySelector('.transform').classList.remove('scale-95'), 10);
            });
            
            document.getElementById('modal-edit-featured-btn').addEventListener('click', () => {
                closeModal('admin-panel-modal');
                renderCurrentFeaturedList();
                editFeaturedModal.classList.remove('hidden');
                setTimeout(() => editFeaturedModal.querySelector('.transform').classList.remove('scale-95'), 10);
            });
            
            editFeaturedModalCloseBtn.addEventListener('click', () => closeModal('edit-featured-modal'));
            
            document.getElementById('featured-search-bar').addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase().trim();
                const resultsContainer = document.getElementById('featured-search-results');
                if (searchTerm.length < 2) {
                    resultsContainer.innerHTML = '';
                    return;
                }
                
                const allMovies = Object.values(mockApiData.movies).flat();
                const uniqueMovies = Array.from(new Map(allMovies.map(m => [m.id, m])).values());
                const results = uniqueMovies.filter(movie => movie.title.toLowerCase().includes(searchTerm)).slice(0, 10);

                resultsContainer.innerHTML = results.map(movie => `
                    <div class="flex items-center justify-between p-2 hover:bg-neutral-700 rounded-md cursor-pointer" onclick="addFeaturedItem(${movie.id})">
                        <span>${movie.title}</span>
                        <button class="text-green-500 text-sm font-bold">Add</button>
                    </div>
                `).join('');
            });

            window.addFeaturedItem = function(movieId) {
                if (!mockApiData.featuredIds.includes(movieId)) {
                    mockApiData.featuredIds.push(movieId);
                    localStorage.setItem('movieDatabase', JSON.stringify(mockApiData));
                    renderCurrentFeaturedList();
                    displayFeaturedMovies();
                }
                document.getElementById('featured-search-bar').value = '';
                document.getElementById('featured-search-results').innerHTML = '';
            }

            document.getElementById('modal-edit-socials-btn').addEventListener('click', () => {
                closeModal('admin-panel-modal');
                const editSocialsModal = document.getElementById('edit-socials-modal');
                const socialLinksInputsContainer = document.getElementById('social-links-inputs-container');
                const links = mockApiData.socialLinks || {};
                socialLinksInputsContainer.innerHTML = ''; // Clear previous inputs
                Object.entries(links).forEach(([name, url]) => {
                    const linkGroup = document.createElement('div');
                    linkGroup.className = 'social-link-group grid grid-cols-2 gap-2';
                    linkGroup.innerHTML = `
                        <input data-type="name" type="text" value="${name}" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                        <input data-type="url" type="text" value="${url}" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                    `;
                    socialLinksInputsContainer.appendChild(linkGroup);
                });

                editSocialsModal.classList.remove('hidden');
                setTimeout(() => editSocialsModal.querySelector('.transform').classList.remove('scale-95'), 10);
            });
            
            document.getElementById('modal-edit-ads-btn').addEventListener('click', () => {
                closeModal('admin-panel-modal');
                const editAdsModal = document.getElementById('edit-ads-modal');
                const editAdsForm = document.getElementById('edit-ads-form');
                const adCodes = mockApiData.ads || {};
                
                editAdsForm.querySelector('[name="adLeft1"]').value = adCodes.adLeft1 || '';
                editAdsForm.querySelector('[name="adLeftImg1"]').value = adCodes.adLeftImg1 || '';
                editAdsForm.querySelector('[name="adLeftImg2"]').value = adCodes.adLeftImg2 || '';
                editAdsForm.querySelector('[name="adLeftImg3"]').value = adCodes.adLeftImg3 || '';
                editAdsForm.querySelector('[name="adLeftImg4"]').value = adCodes.adLeftImg4 || '';
                editAdsForm.querySelector('[name="sidebarVideo"]').value = adCodes.sidebarVideo || '';
                editAdsForm.querySelector('[name="right1"]').value = adCodes.right1 || '';
                editAdsForm.querySelector('[name="right2"]').value = adCodes.right2 || '';
                editAdsForm.querySelector('[name="rightNative"]').value = adCodes.rightNative || '';
                editAdsForm.querySelector('[name="rightImg1"]').value = adCodes.rightImg1 || '';
                editAdsForm.querySelector('[name="rightImg2"]').value = adCodes.rightImg2 || '';
                editAdsForm.querySelector('[name="rightImg3"]').value = adCodes.rightImg3 || '';
                editAdsForm.querySelector('[name="right468x60"]').value = adCodes.right468x60 || '';
                editAdsForm.querySelector('[name="right320x50"]').value = adCodes.right320x50 || '';
                editAdsForm.querySelector('[name="adSocialBar"]').value = adCodes.adSocialBar || '';
                editAdsForm.querySelector('[name="adPopunder"]').value = adCodes.adPopunder || '';
                editAdsForm.querySelector('[name="adFooter728x90"]').value = adCodes.adFooter728x90 || '';

                editAdsModal.classList.remove('hidden');
                setTimeout(() => editAdsModal.querySelector('.transform').classList.remove('scale-95'), 10);
            });

            document.getElementById('modal-view-requests-btn').addEventListener('click', () => {
                closeModal('admin-panel-modal');
                showRequests();
            });


            addDownloadLinkBtn.addEventListener('click', addDownloadLinkField);
            addMovieForm.addEventListener('submit', handleSaveContent);

            addMovieModalCloseBtn.addEventListener('click', () => closeModal('add-movie-modal'));
            addMovieModal.addEventListener('click', (e) => {
                if (e.target === addMovieModal) closeModal('add-movie-modal');
            });

            requestMovieBtn.addEventListener('click', () => {
                 requestMovieModal.classList.remove('hidden');
                 setTimeout(() => requestMovieModal.querySelector('.transform').classList.remove('scale-95'), 10);
            });
            requestModalCloseBtn.addEventListener('click', () => closeModal('request-movie-modal'));
            requestMovieModal.addEventListener('click', (e) => {
                if (e.target === requestMovieModal) closeModal('request-movie-modal');
            });
            requestMovieForm.addEventListener('submit', handleMovieRequest);

            viewRequestsModalCloseBtn.addEventListener('click', () => closeModal('view-requests-modal'));
            clearRequestsBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all movie requests?')) {
                    localStorage.removeItem('movieRequests');
                    requestsList.innerHTML = `<p class="text-gray-400">No pending movie requests.</p>`;
                    checkForMovieRequests();
                }
            });

            addSocialLinkBtn.addEventListener('click', () => {
                const newLinkGroup = document.createElement('div');
                newLinkGroup.className = 'social-link-group grid grid-cols-2 gap-2';
                newLinkGroup.innerHTML = `
                    <input data-type="name" type="text" placeholder="Social Name (e.g. Instagram)" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                    <input data-type="url" type="text" placeholder="URL" class="form-input w-full p-3 rounded-md focus:ring-red-500 focus:border-red-500">
                `;
                socialLinksInputsContainer.appendChild(newLinkGroup);
            });

            editSocialsModalCloseBtn.addEventListener('click', () => closeModal('edit-socials-modal'));
            editSocialsModal.addEventListener('click', (e) => {
                if (e.target === editSocialsModal) closeModal('edit-socials-modal');
            });
            editSocialsForm.addEventListener('submit', handleUpdateSocials);

            editAdsModalCloseBtn.addEventListener('click', () => closeModal('edit-ads-modal'));
            editAdsModal.addEventListener('click', (e) => {
                if (e.target === editAdsModal) closeModal('edit-ads-modal');
            });
            editAdsForm.addEventListener('submit', handleUpdateAds);
            
            themeToggleBtn.addEventListener('click', () => {
                const currentTheme = localStorage.getItem('theme') || 'dark';
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('theme', newTheme);
                applyTheme(newTheme);
            });

            mobileMenuBtn.addEventListener('click', () => {
                buildAndBindMobileMenu();
                mobileMenu.classList.remove('hidden');
            });

            mobileMenuCloseBtn.addEventListener('click', () => {
                mobileMenu.classList.add('hidden');
            });

            filterToggleBtn.addEventListener('click', () => {
                leftSidebar.classList.toggle('hidden');
            });
            
            featuredPrevBtn.addEventListener('click', () => {
                featuredSlider.scrollBy({ left: -featuredSlider.clientWidth, behavior: 'smooth' });
            });

            featuredNextBtn.addEventListener('click', () => {
                featuredSlider.scrollBy({ left: featuredSlider.clientWidth, behavior: 'smooth' });
            });
            
            window.addEventListener('scroll', () => {
                if (window.pageYOffset > 200) {
                    backToTopBtn.classList.remove('hidden');
                } else {
                    backToTopBtn.classList.add('hidden');
                }
            });

            backToTopBtn.addEventListener('click', () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    if (!detailsModal.classList.contains('hidden')) closeModal('movie-details-modal');
                    if (!addMovieModal.classList.contains('hidden')) closeModal('add-movie-modal');
                    if (!requestMovieModal.classList.contains('hidden')) closeModal('request-movie-modal');
                    if (!viewRequestsModal.classList.contains('hidden')) closeModal('view-requests-modal');
                    if (!editSocialsModal.classList.contains('hidden')) closeModal('edit-socials-modal');
                    if (!editAdsModal.classList.contains('hidden')) closeModal('edit-ads-modal');
                    if (!editFeaturedModal.classList.contains('hidden')) closeModal('edit-featured-modal');
                    if (!document.getElementById('trailer-modal').classList.contains('hidden')) closeModal('trailer-modal');
                    if (!document.getElementById('stream-modal').classList.contains('hidden')) closeModal('stream-modal');
                    if (!passwordResetModal.classList.contains('hidden')) closeModal('password-reset-modal');
                    if (!mobileMenu.classList.contains('hidden')) mobileMenu.classList.add('hidden');
                    if(!leftSidebar.classList.contains('hidden')) leftSidebar.classList.add('hidden');
                }
            });
            
             // Apply saved theme on load
            const savedTheme = localStorage.getItem('theme') || 'dark';
            applyTheme(savedTheme);

        }

        // Auto-login if user is already saved
        document.addEventListener('DOMContentLoaded', () => {
            loadDatabase();
            const currentUser = localStorage.getItem('currentUser');
            if (currentUser) {
                document.getElementById('login-section').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                initializeMainApp();
            } else {
                initializeLoginPage();
            }

            // Visitor Counter Logic - runs on every load
            displaySocialIcons('social-icons-container');
            const visitorCountSpan = document.getElementById('visitor-count');
            let visitorData = JSON.parse(localStorage.getItem('visitorData')) || {};
            const today = new Date();
            const currentMonth = `${today.getFullYear()}-${today.getMonth()}`;

            if (visitorData.month !== currentMonth) {
                visitorData = {
                    month: currentMonth,
                    count: Math.floor(Math.random() * 500) + 1500 // Start with a random base
                };
            }
            
            visitorData.count++;
            localStorage.setItem('visitorData', JSON.stringify(visitorData));
            visitorCountSpan.textContent = visitorData.count.toLocaleString();
            
            document.getElementById('login-title').addEventListener('click', () => location.reload());
        });
    </script>
</body>
</html>
